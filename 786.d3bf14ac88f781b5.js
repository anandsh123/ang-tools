"use strict";(self.webpackChunkang_tools=self.webpackChunkang_tools||[]).push([[786],{2430:(Wn,wt,be)=>{be.d(wt,{BH:()=>Mt,LL:()=>Cr,ZR:()=>En,L:()=>q,Sg:()=>Fe,vZ:()=>Ht,aH:()=>We,P0:()=>yn,m9:()=>P,z$:()=>Tn,Xx:()=>Gt,hl:()=>vi,G6:()=>Ai,Uo:()=>Pr,dp:()=>J,eu:()=>Hn});var H=be(5861);const Ye=function(_){const g=[];let A=0;for(let O=0;O<_.length;O++){let N=_.charCodeAt(O);N<128?g[A++]=N:N<2048?(g[A++]=N>>6|192,g[A++]=63&N|128):55296==(64512&N)&&O+1<_.length&&56320==(64512&_.charCodeAt(O+1))?(N=65536+((1023&N)<<10)+(1023&_.charCodeAt(++O)),g[A++]=N>>18|240,g[A++]=N>>12&63|128,g[A++]=N>>6&63|128,g[A++]=63&N|128):(g[A++]=N>>12|224,g[A++]=N>>6&63|128,g[A++]=63&N|128)}return g},ut={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(_,g){if(!Array.isArray(_))throw Error("encodeByteArray takes an array as a parameter");this.init_();const A=g?this.byteToCharMapWebSafe_:this.byteToCharMap_,O=[];for(let N=0;N<_.length;N+=3){const Z=_[N],oe=N+1<_.length,De=oe?_[N+1]:0,Ue=N+2<_.length,nt=Ue?_[N+2]:0;let ae=(15&De)<<2|nt>>6,St=63&nt;Ue||(St=64,oe||(ae=64)),O.push(A[Z>>2],A[(3&Z)<<4|De>>4],A[ae],A[St])}return O.join("")},encodeString(_,g){return this.HAS_NATIVE_SUPPORT&&!g?btoa(_):this.encodeByteArray(Ye(_),g)},decodeString(_,g){return this.HAS_NATIVE_SUPPORT&&!g?atob(_):function(_){const g=[];let A=0,O=0;for(;A<_.length;){const N=_[A++];if(N<128)g[O++]=String.fromCharCode(N);else if(N>191&&N<224){const Z=_[A++];g[O++]=String.fromCharCode((31&N)<<6|63&Z)}else if(N>239&&N<365){const Ue=((7&N)<<18|(63&_[A++])<<12|(63&_[A++])<<6|63&_[A++])-65536;g[O++]=String.fromCharCode(55296+(Ue>>10)),g[O++]=String.fromCharCode(56320+(1023&Ue))}else{const Z=_[A++],oe=_[A++];g[O++]=String.fromCharCode((15&N)<<12|(63&Z)<<6|63&oe)}}return g.join("")}(this.decodeStringToByteArray(_,g))},decodeStringToByteArray(_,g){this.init_();const A=g?this.charToByteMapWebSafe_:this.charToByteMap_,O=[];for(let N=0;N<_.length;){const Z=A[_.charAt(N++)],De=N<_.length?A[_.charAt(N)]:0;++N;const nt=N<_.length?A[_.charAt(N)]:64;++N;const pe=N<_.length?A[_.charAt(N)]:64;if(++N,null==Z||null==De||null==nt||null==pe)throw new Qe;O.push(Z<<2|De>>4),64!==nt&&(O.push(De<<4&240|nt>>2),64!==pe&&O.push(nt<<6&192|pe))}return O},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let _=0;_<this.ENCODED_VALS.length;_++)this.byteToCharMap_[_]=this.ENCODED_VALS.charAt(_),this.charToByteMap_[this.byteToCharMap_[_]]=_,this.byteToCharMapWebSafe_[_]=this.ENCODED_VALS_WEBSAFE.charAt(_),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[_]]=_,_>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(_)]=_,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(_)]=_)}}};class Qe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const q=function(_){return function(_){const g=Ye(_);return ut.encodeByteArray(g,!0)}(_).replace(/\./g,"")},dt=()=>{try{return function Me(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const _=process.env.__FIREBASE_DEFAULTS__;return _?JSON.parse(_):void 0})()||(()=>{if(typeof document>"u")return;let _;try{_=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const g=_&&function(_){try{return ut.decodeString(_,!0)}catch(g){console.error("base64Decode failed: ",g)}return null}(_[1]);return g&&JSON.parse(g)})()}catch(_){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${_}`)}},yn=_=>{const g=(_=>dt()?.emulatorHosts?.[_])(_);if(!g)return;const A=g.lastIndexOf(":");if(A<=0||A+1===g.length)throw new Error(`Invalid host ${g} with no separate hostname and port!`);const O=parseInt(g.substring(A+1),10);return"["===g[0]?[g.substring(1,A-1),O]:[g.substring(0,A),O]},We=()=>dt()?.config;class Mt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((g,A)=>{this.resolve=g,this.reject=A})}wrapCallback(g){return(A,O)=>{A?this.reject(A):this.resolve(O),"function"==typeof g&&(this.promise.catch(()=>{}),1===g.length?g(A):g(A,O))}}}function Gt(_){try{return(_.startsWith("http://")||_.startsWith("https://")?new URL(_).hostname:_).endsWith(".cloudworkstations.dev")}catch{return!1}}function Pr(_){return B.apply(this,arguments)}function B(){return(B=(0,H.Z)(function*(_){return(yield fetch(_,{credentials:"include"})).ok})).apply(this,arguments)}function Fe(_,g){if(_.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const O=g||"demo-project",N=_.iat||0,Z=_.sub||_.user_id;if(!Z)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const oe={iss:`https://securetoken.google.com/${O}`,aud:O,iat:N,exp:N+3600,auth_time:N,sub:Z,user_id:Z,firebase:{sign_in_provider:"custom",identities:{}},..._};return[q(JSON.stringify({alg:"none",type:"JWT"})),q(JSON.stringify(oe)),""].join(".")}const tt={};let bt=!1;function J(_,g){if(typeof window>"u"||typeof document>"u"||!Gt(window.location.host)||tt[_]===g||tt[_]||bt)return;function A(ae){return`__firebase__banner__${ae}`}tt[_]=g;const O="__firebase__banner",Z=function Kt(){const _={prod:[],emulator:[]};for(const g of Object.keys(tt))tt[g]?_.emulator.push(g):_.prod.push(g);return _}().prod.length>0;function pe(){const ae=function W(_){let g=document.getElementById(_),A=!1;return g||(g=document.createElement("div"),g.setAttribute("id",_),A=!0),{created:A,element:g}}(O),St=A("text"),b=document.getElementById(St)||document.createElement("span"),R=A("learnmore"),M=document.getElementById(R)||document.createElement("a"),K=A("preprendIcon"),te=document.getElementById(K)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ae.created){const le=ae.element;(function De(ae){ae.style.display="flex",ae.style.background="#7faaf0",ae.style.position="fixed",ae.style.bottom="5px",ae.style.left="5px",ae.style.padding=".5em",ae.style.borderRadius="5px",ae.style.alignItems="center"})(le),function yt(ae,St){ae.setAttribute("id",St),ae.innerText="Learn more",ae.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ae.setAttribute("target","__blank"),ae.style.paddingLeft="5px",ae.style.textDecoration="underline"}(M,R);const ie=function nt(){const ae=document.createElement("span");return ae.style.cursor="pointer",ae.style.marginLeft="16px",ae.style.fontSize="24px",ae.innerHTML=" &times;",ae.onclick=()=>{bt=!0,function oe(){const ae=document.getElementById(O);ae&&ae.remove()}()},ae}();(function Ue(ae,St){ae.setAttribute("width","24"),ae.setAttribute("id",St),ae.setAttribute("height","24"),ae.setAttribute("viewBox","0 0 24 24"),ae.setAttribute("fill","none"),ae.style.marginLeft="-6px"})(te,K),le.append(te,b,M,ie),document.body.appendChild(le)}Z?(b.innerText="Preview backend disconnected.",te.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(te.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',b.innerText="Preview backend running in this workspace."),b.setAttribute("id",St)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",pe):pe()}function Tn(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ai(){return!function C(){const _=dt()?.forceEnvironment;if("node"===_)return!0;if("browser"===_)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vi(){try{return"object"==typeof indexedDB}catch{return!1}}function Hn(){return new Promise((_,g)=>{try{let A=!0;const O="validate-browser-context-for-indexeddb-analytics-module",N=self.indexedDB.open(O);N.onsuccess=()=>{N.result.close(),A||self.indexedDB.deleteDatabase(O),_(!0)},N.onupgradeneeded=()=>{A=!1},N.onerror=()=>{g(N.error?.message||"")}}catch(A){g(A)}})}class En extends Error{constructor(g,A,O){super(A),this.code=g,this.customData=O,this.name="FirebaseError",Object.setPrototypeOf(this,En.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Cr.prototype.create)}}class Cr{constructor(g,A,O){this.service=g,this.serviceName=A,this.errors=O}create(g,...A){const O=A[0]||{},N=`${this.service}/${g}`,Z=this.errors[g],oe=Z?function Xn(_,g){return _.replace(Qt,(A,O)=>{const N=g[O];return null!=N?String(N):`<${O}?>`})}(Z,O):"Error";return new En(N,`${this.serviceName}: ${oe} (${N}).`,O)}}const Qt=/\{\$([^}]+)}/g;function Ht(_,g){if(_===g)return!0;const A=Object.keys(_),O=Object.keys(g);for(const N of A){if(!O.includes(N))return!1;const Z=_[N],oe=g[N];if(Jt(Z)&&Jt(oe)){if(!Ht(Z,oe))return!1}else if(Z!==oe)return!1}for(const N of O)if(!A.includes(N))return!1;return!0}function Jt(_){return null!==_&&"object"==typeof _}function P(_){return _&&_._delegate?_._delegate:_}},1152:(Wn,wt,be)=>{be.d(wt,{R:()=>st});var H=be(2109);(0,H.KN)("firebase","12.4.0","app");var he=be(5159);const Ye=(0,H.ZF)({apiKey:"AIzaSyCumVDMWNYRUmnfklfnN5ALHjuEaeKHTKw",authDomain:"angular-tools-60fd6.firebaseapp.com",projectId:"angular-tools-60fd6",storageBucket:"angular-tools-60fd6.firebasestorage.app",messagingSenderId:"491860174717",appId:"1:491860174717:web:291a0e1d8586d67ae58e14",measurementId:"G-3H6DJRTBGK"}),st=(0,he.ad)(Ye)},3101:(Wn,wt,be)=>{be.d(wt,{E:()=>Ve});var H=be(4408);let Ke,Y=1;const he={};function ve(Me){return Me in he&&(delete he[Me],!0)}const Ye={setImmediate(Me){const ue=Y++;return he[ue]=!0,Ke||(Ke=Promise.resolve()),Ke.then(()=>ve(ue)&&Me()),ue},clearImmediate(Me){ve(Me)}},{setImmediate:ut,clearImmediate:Qe}=Ye,j={setImmediate(...Me){const{delegate:ue}=j;return(ue?.setImmediate||ut)(...Me)},clearImmediate(Me){const{delegate:ue}=j;return(ue?.clearImmediate||Qe)(Me)},delegate:void 0};var re=be(640);const Ve=new class Re extends re.v{flush(ue){this._active=!0;const we=this._scheduled;this._scheduled=void 0;const{actions:Ze}=this;let dt;ue=ue||Ze.shift();do{if(dt=ue.execute(ue.state,ue.delay))break}while((ue=Ze[0])&&ue.id===we&&Ze.shift());if(this._active=!1,dt){for(;(ue=Ze[0])&&ue.id===we&&Ze.shift();)ue.unsubscribe();throw dt}}}(class q extends H.o{constructor(ue,we){super(ue,we),this.scheduler=ue,this.work=we}requestAsyncId(ue,we,Ze=0){return null!==Ze&&Ze>0?super.requestAsyncId(ue,we,Ze):(ue.actions.push(this),ue._scheduled||(ue._scheduled=j.setImmediate(ue.flush.bind(ue,void 0))))}recycleAsyncId(ue,we,Ze=0){var dt;if(null!=Ze?Ze>0:this.delay>0)return super.recycleAsyncId(ue,we,Ze);const{actions:gt}=ue;null!=we&&(null===(dt=gt[gt.length-1])||void 0===dt?void 0:dt.id)!==we&&(j.clearImmediate(we),ue._scheduled===we&&(ue._scheduled=void 0))}})},2109:(Wn,wt,be)=>{be.d(wt,{Jn:()=>kr,qX:()=>Jt,rh:()=>Xt,Xd:()=>Ht,Mq:()=>Yt,ZF:()=>xt,KN:()=>Zt});var H=be(5861),Y=be(2859),Ke=be(1639),he=be(2430);const ve=(b,R)=>R.some(M=>b instanceof M);let Ye,st;const j=new WeakMap,q=new WeakMap,re=new WeakMap,Re=new WeakMap,Ve=new WeakMap;let ue={get(b,R,M){if(b instanceof IDBTransaction){if("done"===R)return q.get(b);if("objectStoreNames"===R)return b.objectStoreNames||re.get(b);if("store"===R)return M.objectStoreNames[1]?void 0:M.objectStore(M.objectStoreNames[0])}return gt(b[R])},set:(b,R,M)=>(b[R]=M,!0),has:(b,R)=>b instanceof IDBTransaction&&("done"===R||"store"===R)||R in b};function dt(b){return"function"==typeof b?function Ze(b){return b!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Qe(){return st||(st=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(b)?function(...R){return b.apply(yn(this),R),gt(j.get(this))}:function(...R){return gt(b.apply(yn(this),R))}:function(R,...M){const K=b.call(yn(this),R,...M);return re.set(K,R.sort?R.sort():[R]),gt(K)}}(b):(b instanceof IDBTransaction&&function Me(b){if(q.has(b))return;const R=new Promise((M,K)=>{const te=()=>{b.removeEventListener("complete",le),b.removeEventListener("error",ie),b.removeEventListener("abort",ie)},le=()=>{M(),te()},ie=()=>{K(b.error||new DOMException("AbortError","AbortError")),te()};b.addEventListener("complete",le),b.addEventListener("error",ie),b.addEventListener("abort",ie)});q.set(b,R)}(b),ve(b,function ut(){return Ye||(Ye=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(b,ue):b)}function gt(b){if(b instanceof IDBRequest)return function Ut(b){const R=new Promise((M,K)=>{const te=()=>{b.removeEventListener("success",le),b.removeEventListener("error",ie)},le=()=>{M(gt(b.result)),te()},ie=()=>{K(b.error),te()};b.addEventListener("success",le),b.addEventListener("error",ie)});return R.then(M=>{M instanceof IDBCursor&&j.set(M,b)}).catch(()=>{}),Ve.set(R,b),R}(b);if(Re.has(b))return Re.get(b);const R=dt(b);return R!==b&&(Re.set(b,R),Ve.set(R,b)),R}const yn=b=>Ve.get(b),Mt=["get","getKey","getAll","getAllKeys","count"],Gt=["put","add","delete","clear"],Pr=new Map;function B(b,R){if(!(b instanceof IDBDatabase)||R in b||"string"!=typeof R)return;if(Pr.get(R))return Pr.get(R);const M=R.replace(/FromIndex$/,""),K=R!==M,te=Gt.includes(M);if(!(M in(K?IDBIndex:IDBObjectStore).prototype)||!te&&!Mt.includes(M))return;const le=function(){var ie=(0,H.Z)(function*(It,...ze){const rt=this.transaction(It,te?"readwrite":"readonly");let Pt=rt.store;return K&&(Pt=Pt.index(ze.shift())),(yield Promise.all([Pt[M](...ze),te&&rt.done]))[0]});return function(ze){return ie.apply(this,arguments)}}();return Pr.set(R,le),le}!function we(b){ue=b(ue)}(b=>({...b,get:(R,M,K)=>B(R,M)||b.get(R,M,K),has:(R,M)=>!!B(R,M)||b.has(R,M)}));class Fe{constructor(R){this.container=R}getPlatformInfoString(){return this.container.getProviders().map(M=>{if(function tt(b){return"VERSION"===b.getComponent()?.type}(M)){const K=M.getImmediate();return`${K.library}/${K.version}`}return null}).filter(M=>M).join(" ")}}const Kt="@firebase/app",W="0.14.4",bt=new Ke.Yd("@firebase/app"),Zn="[DEFAULT]",xe={[Kt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},z=new Map,Wt=new Map,An=new Map;function Dr(b,R){try{b.container.addComponent(R)}catch(M){bt.debug(`Component ${R.name} failed to register with FirebaseApp ${b.name}`,M)}}function Ht(b){const R=b.name;if(An.has(R))return bt.debug(`There were multiple attempts to register component ${R}.`),!1;An.set(R,b);for(const M of z.values())Dr(M,b);for(const M of Wt.values())Dr(M,b);return!0}function Jt(b,R){const M=b.container.getProvider("heartbeat").getImmediate({optional:!0});return M&&M.triggerHeartbeat(),b.container.getProvider(R)}function Xt(b){return null!=b&&void 0!==b.settings}const de=new he.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ee{constructor(R,M,K){this._isDeleted=!1,this._options={...R},this._config={...M},this._name=M.name,this._automaticDataCollectionEnabled=M.automaticDataCollectionEnabled,this._container=K,this.container.addComponent(new Y.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(R){this.checkDestroyed(),this._automaticDataCollectionEnabled=R}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(R){this._isDeleted=R}checkDestroyed(){if(this.isDeleted)throw de.create("app-deleted",{appName:this._name})}}const kr="12.4.0";function xt(b,R={}){let M=b;"object"!=typeof R&&(R={name:R});const K={name:Zn,automaticDataCollectionEnabled:!0,...R},te=K.name;if("string"!=typeof te||!te)throw de.create("bad-app-name",{appName:String(te)});if(M||(M=(0,he.aH)()),!M)throw de.create("no-options");const le=z.get(te);if(le){if((0,he.vZ)(M,le.options)&&(0,he.vZ)(K,le.config))return le;throw de.create("duplicate-app",{appName:te})}const ie=new Y.H0(te);for(const ze of An.values())ie.addComponent(ze);const It=new ee(M,K,ie);return z.set(te,It),It}function Yt(b=Zn){const R=z.get(b);if(!R&&b===Zn&&(0,he.aH)())return xt();if(!R)throw de.create("no-app",{appName:b});return R}function Zt(b,R,M){let K=xe[b]??b;M&&(K+=`-${M}`);const te=K.match(/\s|\//),le=R.match(/\s|\//);if(te||le){const ie=[`Unable to register library "${K}" with version "${R}":`];return te&&ie.push(`library name "${K}" contains illegal characters (whitespace or "/")`),te&&le&&ie.push("and"),le&&ie.push(`version name "${R}" contains illegal characters (whitespace or "/")`),void bt.warn(ie.join(" "))}Ht(new Y.wA(`${K}-version`,()=>({library:K,version:R}),"VERSION"))}const Or="firebase-heartbeat-database",Ds=1,Rt="firebase-heartbeat-store";let ln=null;function P(){return ln||(ln=function We(b,R,{blocked:M,upgrade:K,blocking:te,terminated:le}={}){const ie=indexedDB.open(b,R),It=gt(ie);return K&&ie.addEventListener("upgradeneeded",ze=>{K(gt(ie.result),ze.oldVersion,ze.newVersion,gt(ie.transaction),ze)}),M&&ie.addEventListener("blocked",ze=>M(ze.oldVersion,ze.newVersion,ze)),It.then(ze=>{le&&ze.addEventListener("close",()=>le()),te&&ze.addEventListener("versionchange",rt=>te(rt.oldVersion,rt.newVersion,rt))}).catch(()=>{}),It}(Or,Ds,{upgrade:(b,R)=>{if(0===R)try{b.createObjectStore(Rt)}catch(M){console.warn(M)}}}).catch(b=>{throw de.create("idb-open",{originalErrorMessage:b.message})})),ln}function g(){return(g=(0,H.Z)(function*(b){try{const M=(yield P()).transaction(Rt),K=yield M.objectStore(Rt).get(N(b));return yield M.done,K}catch(R){if(R instanceof he.ZR)bt.warn(R.message);else{const M=de.create("idb-get",{originalErrorMessage:R?.message});bt.warn(M.message)}}})).apply(this,arguments)}function A(b,R){return O.apply(this,arguments)}function O(){return(O=(0,H.Z)(function*(b,R){try{const K=(yield P()).transaction(Rt,"readwrite");yield K.objectStore(Rt).put(R,N(b)),yield K.done}catch(M){if(M instanceof he.ZR)bt.warn(M.message);else{const K=de.create("idb-set",{originalErrorMessage:M?.message});bt.warn(K.message)}}})).apply(this,arguments)}function N(b){return`${b.name}!${b.options.appId}`}class De{constructor(R){this.container=R,this._heartbeatsCache=null;const M=this.container.getProvider("app").getImmediate();this._storage=new yt(M),this._heartbeatsCachePromise=this._storage.read().then(K=>(this._heartbeatsCache=K,K))}triggerHeartbeat(){var R=this;return(0,H.Z)(function*(){try{const K=R.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),te=Ue();if(null==R._heartbeatsCache?.heartbeats&&(R._heartbeatsCache=yield R._heartbeatsCachePromise,null==R._heartbeatsCache?.heartbeats)||R._heartbeatsCache.lastSentHeartbeatDate===te||R._heartbeatsCache.heartbeats.some(le=>le.date===te))return;if(R._heartbeatsCache.heartbeats.push({date:te,agent:K}),R._heartbeatsCache.heartbeats.length>30){const le=function ae(b){if(0===b.length)return-1;let R=0,M=b[0].date;for(let K=1;K<b.length;K++)b[K].date<M&&(M=b[K].date,R=K);return R}(R._heartbeatsCache.heartbeats);R._heartbeatsCache.heartbeats.splice(le,1)}return R._storage.overwrite(R._heartbeatsCache)}catch(M){bt.warn(M)}})()}getHeartbeatsHeader(){var R=this;return(0,H.Z)(function*(){try{if(null===R._heartbeatsCache&&(yield R._heartbeatsCachePromise),null==R._heartbeatsCache?.heartbeats||0===R._heartbeatsCache.heartbeats.length)return"";const M=Ue(),{heartbeatsToSend:K,unsentEntries:te}=function nt(b,R=1024){const M=[];let K=b.slice();for(const te of b){const le=M.find(ie=>ie.agent===te.agent);if(le){if(le.dates.push(te.date),pe(M)>R){le.dates.pop();break}}else if(M.push({agent:te.agent,dates:[te.date]}),pe(M)>R){M.pop();break}K=K.slice(1)}return{heartbeatsToSend:M,unsentEntries:K}}(R._heartbeatsCache.heartbeats),le=(0,he.L)(JSON.stringify({version:2,heartbeats:K}));return R._heartbeatsCache.lastSentHeartbeatDate=M,te.length>0?(R._heartbeatsCache.heartbeats=te,yield R._storage.overwrite(R._heartbeatsCache)):(R._heartbeatsCache.heartbeats=[],R._storage.overwrite(R._heartbeatsCache)),le}catch(M){return bt.warn(M),""}})()}}function Ue(){return(new Date).toISOString().substring(0,10)}class yt{constructor(R){this.app=R,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,H.Z)(function*(){return!!(0,he.hl)()&&(0,he.eu)().then(()=>!0).catch(()=>!1)})()}read(){var R=this;return(0,H.Z)(function*(){if(yield R._canUseIndexedDBPromise){const K=yield function _(b){return g.apply(this,arguments)}(R.app);return K?.heartbeats?K:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(R){var M=this;return(0,H.Z)(function*(){if(yield M._canUseIndexedDBPromise){const te=yield M.read();return A(M.app,{lastSentHeartbeatDate:R.lastSentHeartbeatDate??te.lastSentHeartbeatDate,heartbeats:R.heartbeats})}})()}add(R){var M=this;return(0,H.Z)(function*(){if(yield M._canUseIndexedDBPromise){const te=yield M.read();return A(M.app,{lastSentHeartbeatDate:R.lastSentHeartbeatDate??te.lastSentHeartbeatDate,heartbeats:[...te.heartbeats,...R.heartbeats]})}})()}}function pe(b){return(0,he.L)(JSON.stringify({version:2,heartbeats:b})).length}!function St(b){Ht(new Y.wA("platform-logger",R=>new Fe(R),"PRIVATE")),Ht(new Y.wA("heartbeat",R=>new De(R),"PRIVATE")),Zt(Kt,W,b),Zt(Kt,W,"esm2020"),Zt("fire-js","")}("")},2859:(Wn,wt,be)=>{be.d(wt,{H0:()=>ut,wA:()=>Ke});var H=be(5861),Y=be(2430);class Ke{constructor(j,q,re){this.name=j,this.instanceFactory=q,this.type=re,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(j){return this.instantiationMode=j,this}setMultipleInstances(j){return this.multipleInstances=j,this}setServiceProps(j){return this.serviceProps=j,this}setInstanceCreatedCallback(j){return this.onInstanceCreated=j,this}}const he="[DEFAULT]";class ve{constructor(j,q){this.name=j,this.container=q,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(j){const q=this.normalizeInstanceIdentifier(j);if(!this.instancesDeferred.has(q)){const re=new Y.BH;if(this.instancesDeferred.set(q,re),this.isInitialized(q)||this.shouldAutoInitialize())try{const Re=this.getOrInitializeService({instanceIdentifier:q});Re&&re.resolve(Re)}catch{}}return this.instancesDeferred.get(q).promise}getImmediate(j){const q=this.normalizeInstanceIdentifier(j?.identifier),re=j?.optional??!1;if(!this.isInitialized(q)&&!this.shouldAutoInitialize()){if(re)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:q})}catch(Re){if(re)return null;throw Re}}getComponent(){return this.component}setComponent(j){if(j.name!==this.name)throw Error(`Mismatching Component ${j.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=j,this.shouldAutoInitialize()){if(function st(Qe){return"EAGER"===Qe.instantiationMode}(j))try{this.getOrInitializeService({instanceIdentifier:he})}catch{}for(const[q,re]of this.instancesDeferred.entries()){const Re=this.normalizeInstanceIdentifier(q);try{const Ve=this.getOrInitializeService({instanceIdentifier:Re});re.resolve(Ve)}catch{}}}}clearInstance(j=he){this.instancesDeferred.delete(j),this.instancesOptions.delete(j),this.instances.delete(j)}delete(){var j=this;return(0,H.Z)(function*(){const q=Array.from(j.instances.values());yield Promise.all([...q.filter(re=>"INTERNAL"in re).map(re=>re.INTERNAL.delete()),...q.filter(re=>"_delete"in re).map(re=>re._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(j=he){return this.instances.has(j)}getOptions(j=he){return this.instancesOptions.get(j)||{}}initialize(j={}){const{options:q={}}=j,re=this.normalizeInstanceIdentifier(j.instanceIdentifier);if(this.isInitialized(re))throw Error(`${this.name}(${re}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const Re=this.getOrInitializeService({instanceIdentifier:re,options:q});for(const[Ve,Ut]of this.instancesDeferred.entries())re===this.normalizeInstanceIdentifier(Ve)&&Ut.resolve(Re);return Re}onInit(j,q){const re=this.normalizeInstanceIdentifier(q),Re=this.onInitCallbacks.get(re)??new Set;Re.add(j),this.onInitCallbacks.set(re,Re);const Ve=this.instances.get(re);return Ve&&j(Ve,re),()=>{Re.delete(j)}}invokeOnInitCallbacks(j,q){const re=this.onInitCallbacks.get(q);if(re)for(const Re of re)try{Re(j,q)}catch{}}getOrInitializeService({instanceIdentifier:j,options:q={}}){let re=this.instances.get(j);if(!re&&this.component&&(re=this.component.instanceFactory(this.container,{instanceIdentifier:(Qe=j,Qe===he?void 0:Qe),options:q}),this.instances.set(j,re),this.instancesOptions.set(j,q),this.invokeOnInitCallbacks(re,j),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,j,re)}catch{}var Qe;return re||null}normalizeInstanceIdentifier(j=he){return this.component?this.component.multipleInstances?j:he:j}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ut{constructor(j){this.name=j,this.providers=new Map}addComponent(j){const q=this.getProvider(j.name);if(q.isComponentSet())throw new Error(`Component ${j.name} has already been registered with ${this.name}`);q.setComponent(j)}addOrOverwriteComponent(j){this.getProvider(j.name).isComponentSet()&&this.providers.delete(j.name),this.addComponent(j)}getProvider(j){if(this.providers.has(j))return this.providers.get(j);const q=new ve(j,this);return this.providers.set(j,q),q}getProviders(){return Array.from(this.providers.values())}}},1639:(Wn,wt,be)=>{be.d(wt,{Yd:()=>st,in:()=>Y});const H=[];var Y=(()=>((Y=Y||{})[Y.DEBUG=0]="DEBUG",Y[Y.VERBOSE=1]="VERBOSE",Y[Y.INFO=2]="INFO",Y[Y.WARN=3]="WARN",Y[Y.ERROR=4]="ERROR",Y[Y.SILENT=5]="SILENT",Y))();const Ke={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},he=Y.INFO,ve={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Ye=(j,q,...re)=>{if(q<j.logLevel)return;const Re=(new Date).toISOString(),Ve=ve[q];if(!Ve)throw new Error(`Attempted to log a message with an invalid logType (value: ${q})`);console[Ve](`[${Re}]  ${j.name}:`,...re)};class st{constructor(q){this.name=q,this._logLevel=he,this._logHandler=Ye,this._userLogHandler=null,H.push(this)}get logLevel(){return this._logLevel}set logLevel(q){if(!(q in Y))throw new TypeError(`Invalid value "${q}" assigned to \`logLevel\``);this._logLevel=q}setLogLevel(q){this._logLevel="string"==typeof q?Ke[q]:q}get logHandler(){return this._logHandler}set logHandler(q){if("function"!=typeof q)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=q}get userLogHandler(){return this._userLogHandler}set userLogHandler(q){this._userLogHandler=q}debug(...q){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...q),this._logHandler(this,Y.DEBUG,...q)}log(...q){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...q),this._logHandler(this,Y.VERBOSE,...q)}info(...q){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...q),this._logHandler(this,Y.INFO,...q)}warn(...q){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...q),this._logHandler(this,Y.WARN,...q)}error(...q){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...q),this._logHandler(this,Y.ERROR,...q)}}},5159:(Wn,wt,be)=>{be.d(wt,{ET:()=>ny,hJ:()=>G_,ad:()=>$_});var ut,H=be(5861),Y=be(2109),Ke=be(2859),he=be(1639),ve=be(2430),Ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},st={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function i(v,y,E){E||(E=0);const S=Array(16);if("string"==typeof y)for(var w=0;w<16;++w)S[w]=y.charCodeAt(E++)|y.charCodeAt(E++)<<8|y.charCodeAt(E++)<<16|y.charCodeAt(E++)<<24;else for(w=0;w<16;++w)S[w]=y[E++]|y[E++]<<8|y[E++]<<16|y[E++]<<24;let T,D=v.g[3];T=(y=v.g[0])+(D^(E=v.g[1])&((w=v.g[2])^D))+S[0]+3614090360&4294967295,T=D+(w^(y=E+(T<<7&4294967295|T>>>25))&(E^w))+S[1]+3905402710&4294967295,D=y+(T<<12&4294967295|T>>>20),T=w+(E^D&(y^E))+S[2]+606105819&4294967295,T=E+(y^(w=D+(T<<17&4294967295|T>>>15))&(D^y))+S[3]+3250441966&4294967295,T=y+(D^(E=w+(T<<22&4294967295|T>>>10))&(w^D))+S[4]+4118548399&4294967295,T=D+(w^(y=E+(T<<7&4294967295|T>>>25))&(E^w))+S[5]+1200080426&4294967295,D=y+(T<<12&4294967295|T>>>20),T=w+(E^D&(y^E))+S[6]+2821735955&4294967295,T=E+(y^(w=D+(T<<17&4294967295|T>>>15))&(D^y))+S[7]+4249261313&4294967295,T=y+(D^(E=w+(T<<22&4294967295|T>>>10))&(w^D))+S[8]+1770035416&4294967295,T=D+(w^(y=E+(T<<7&4294967295|T>>>25))&(E^w))+S[9]+2336552879&4294967295,D=y+(T<<12&4294967295|T>>>20),T=w+(E^D&(y^E))+S[10]+4294925233&4294967295,T=E+(y^(w=D+(T<<17&4294967295|T>>>15))&(D^y))+S[11]+2304563134&4294967295,T=y+(D^(E=w+(T<<22&4294967295|T>>>10))&(w^D))+S[12]+1804603682&4294967295,T=D+(w^(y=E+(T<<7&4294967295|T>>>25))&(E^w))+S[13]+4254626195&4294967295,D=y+(T<<12&4294967295|T>>>20),T=w+(E^D&(y^E))+S[14]+2792965006&4294967295,T=E+(y^(w=D+(T<<17&4294967295|T>>>15))&(D^y))+S[15]+1236535329&4294967295,T=y+(w^D&((E=w+(T<<22&4294967295|T>>>10))^w))+S[1]+4129170786&4294967295,T=D+(E^w&((y=E+(T<<5&4294967295|T>>>27))^E))+S[6]+3225465664&4294967295,D=y+(T<<9&4294967295|T>>>23),T=w+(y^E&(D^y))+S[11]+643717713&4294967295,T=E+(D^y&((w=D+(T<<14&4294967295|T>>>18))^D))+S[0]+3921069994&4294967295,T=y+(w^D&((E=w+(T<<20&4294967295|T>>>12))^w))+S[5]+3593408605&4294967295,T=D+(E^w&((y=E+(T<<5&4294967295|T>>>27))^E))+S[10]+38016083&4294967295,D=y+(T<<9&4294967295|T>>>23),T=w+(y^E&(D^y))+S[15]+3634488961&4294967295,T=E+(D^y&((w=D+(T<<14&4294967295|T>>>18))^D))+S[4]+3889429448&4294967295,T=y+(w^D&((E=w+(T<<20&4294967295|T>>>12))^w))+S[9]+568446438&4294967295,T=D+(E^w&((y=E+(T<<5&4294967295|T>>>27))^E))+S[14]+3275163606&4294967295,D=y+(T<<9&4294967295|T>>>23),T=w+(y^E&(D^y))+S[3]+4107603335&4294967295,T=E+(D^y&((w=D+(T<<14&4294967295|T>>>18))^D))+S[8]+1163531501&4294967295,T=y+(w^D&((E=w+(T<<20&4294967295|T>>>12))^w))+S[13]+2850285829&4294967295,T=D+(E^w&((y=E+(T<<5&4294967295|T>>>27))^E))+S[2]+4243563512&4294967295,D=y+(T<<9&4294967295|T>>>23),T=w+(y^E&(D^y))+S[7]+1735328473&4294967295,T=E+(D^y&((w=D+(T<<14&4294967295|T>>>18))^D))+S[12]+2368359562&4294967295,T=y+((E=w+(T<<20&4294967295|T>>>12))^w^D)+S[5]+4294588738&4294967295,T=D+((y=E+(T<<4&4294967295|T>>>28))^E^w)+S[8]+2272392833&4294967295,D=y+(T<<11&4294967295|T>>>21),T=w+(D^y^E)+S[11]+1839030562&4294967295,T=E+((w=D+(T<<16&4294967295|T>>>16))^D^y)+S[14]+4259657740&4294967295,T=y+((E=w+(T<<23&4294967295|T>>>9))^w^D)+S[1]+2763975236&4294967295,T=D+((y=E+(T<<4&4294967295|T>>>28))^E^w)+S[4]+1272893353&4294967295,D=y+(T<<11&4294967295|T>>>21),T=w+(D^y^E)+S[7]+4139469664&4294967295,T=E+((w=D+(T<<16&4294967295|T>>>16))^D^y)+S[10]+3200236656&4294967295,T=y+((E=w+(T<<23&4294967295|T>>>9))^w^D)+S[13]+681279174&4294967295,T=D+((y=E+(T<<4&4294967295|T>>>28))^E^w)+S[0]+3936430074&4294967295,D=y+(T<<11&4294967295|T>>>21),T=w+(D^y^E)+S[3]+3572445317&4294967295,T=E+((w=D+(T<<16&4294967295|T>>>16))^D^y)+S[6]+76029189&4294967295,T=y+((E=w+(T<<23&4294967295|T>>>9))^w^D)+S[9]+3654602809&4294967295,T=D+((y=E+(T<<4&4294967295|T>>>28))^E^w)+S[12]+3873151461&4294967295,D=y+(T<<11&4294967295|T>>>21),T=w+(D^y^E)+S[15]+530742520&4294967295,T=E+((w=D+(T<<16&4294967295|T>>>16))^D^y)+S[2]+3299628645&4294967295,T=y+(w^((E=w+(T<<23&4294967295|T>>>9))|~D))+S[0]+4096336452&4294967295,T=D+(E^((y=E+(T<<6&4294967295|T>>>26))|~w))+S[7]+1126891415&4294967295,D=y+(T<<10&4294967295|T>>>22),T=w+(y^(D|~E))+S[14]+2878612391&4294967295,T=E+(D^((w=D+(T<<15&4294967295|T>>>17))|~y))+S[5]+4237533241&4294967295,T=y+(w^((E=w+(T<<21&4294967295|T>>>11))|~D))+S[12]+1700485571&4294967295,T=D+(E^((y=E+(T<<6&4294967295|T>>>26))|~w))+S[3]+2399980690&4294967295,D=y+(T<<10&4294967295|T>>>22),T=w+(y^(D|~E))+S[10]+4293915773&4294967295,T=E+(D^((w=D+(T<<15&4294967295|T>>>17))|~y))+S[1]+2240044497&4294967295,T=y+(w^((E=w+(T<<21&4294967295|T>>>11))|~D))+S[8]+1873313359&4294967295,T=D+(E^((y=E+(T<<6&4294967295|T>>>26))|~w))+S[15]+4264355552&4294967295,D=y+(T<<10&4294967295|T>>>22),T=w+(y^(D|~E))+S[6]+2734768916&4294967295,T=E+(D^((w=D+(T<<15&4294967295|T>>>17))|~y))+S[13]+1309151649&4294967295,T=y+(w^((E=w+(T<<21&4294967295|T>>>11))|~D))+S[4]+4149444226&4294967295,T=D+(E^((y=E+(T<<6&4294967295|T>>>26))|~w))+S[11]+3174756917&4294967295,D=y+(T<<10&4294967295|T>>>22),T=w+(y^(D|~E))+S[2]+718787259&4294967295,T=E+(D^((w=D+(T<<15&4294967295|T>>>17))|~y))+S[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(w+(T<<21&4294967295|T>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+D&4294967295}function o(v,y){this.h=y;const E=[];let S=!0;for(let w=v.length-1;w>=0;w--){const D=0|v[w];S&&D==y||(E[w]=D,S=!1)}this.g=E}(function e(v,y){function E(){}E.prototype=y.prototype,v.F=y.prototype,v.prototype=new E,v.prototype.constructor=v,v.D=function(S,w,D){for(var T=Array(arguments.length-2),kt=2;kt<arguments.length;kt++)T[kt-2]=arguments[kt];return y.prototype[w].apply(S,T)}})(n,function t(){this.blockSize=-1}),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.v=function(v,y){void 0===y&&(y=v.length);const E=y-this.blockSize,S=this.C;let w=this.h,D=0;for(;D<y;){if(0==w)for(;D<=E;)i(this,v,D),D+=this.blockSize;if("string"==typeof v){for(;D<y;)if(S[w++]=v.charCodeAt(D++),w==this.blockSize){i(this,S),w=0;break}}else for(;D<y;)if(S[w++]=v[D++],w==this.blockSize){i(this,S),w=0;break}}this.h=w,this.o+=y},n.prototype.A=function(){var v=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;y=8*this.o;for(var E=v.length-8;E<v.length;++E)v[E]=255&y,y/=256;for(this.v(v),v=Array(16),y=0,E=0;E<4;++E)for(let S=0;S<32;S+=8)v[y++]=this.g[E]>>>S&255;return v};var u={};function c(v){return-128<=v&&v<128?function s(v,y){var E=u;return Object.prototype.hasOwnProperty.call(E,v)?E[v]:E[v]=y(v)}(v,function(y){return new o([0|y],y<0?-1:0)}):new o([0|v],v<0?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return p;if(v<0)return U(h(-v));const y=[];let E=1;for(let S=0;v>=E;S++)y[S]=v/E|0,E*=4294967296;return new o(y,0)}var p=c(0),I=c(1),x=c(16777216);function L(v){if(0!=v.h)return!1;for(let y=0;y<v.g.length;y++)if(0!=v.g[y])return!1;return!0}function G(v){return-1==v.h}function U(v){const y=v.g.length,E=[];for(let S=0;S<y;S++)E[S]=~v.g[S];return new o(E,~v.h).add(I)}function X(v,y){return v.add(U(y))}function ce(v,y){for(;(65535&v[y])!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function ne(v,y){this.g=v,this.h=y}function Ie(v,y){if(L(y))throw Error("division by zero");if(L(v))return new ne(p,p);if(G(v))return y=Ie(U(v),y),new ne(U(y.g),U(y.h));if(G(y))return y=Ie(v,U(y)),new ne(U(y.g),y.h);if(v.g.length>30){if(G(v)||G(y))throw Error("slowDivide_ only works with positive integers.");for(var E=I,S=y;S.l(v)<=0;)E=Ee(E),S=Ee(S);var w=Ae(E,1),D=Ae(S,1);for(S=Ae(S,2),E=Ae(E,2);!L(S);){var T=D.add(S);T.l(v)<=0&&(w=w.add(E),D=T),S=Ae(S,1),E=Ae(E,1)}return y=X(v,w.j(y)),new ne(w,y)}for(w=p;v.l(y)>=0;){for(E=Math.max(1,Math.floor(v.m()/y.m())),S=(S=Math.ceil(Math.log(E)/Math.LN2))<=48?1:Math.pow(2,S-48),T=(D=h(E)).j(y);G(T)||T.l(v)>0;)T=(D=h(E-=S)).j(y);L(D)&&(D=I),w=w.add(D),v=X(v,T)}return new ne(w,v)}function Ee(v){const y=v.g.length+1,E=[];for(let S=0;S<y;S++)E[S]=v.i(S)<<1|v.i(S-1)>>>31;return new o(E,v.h)}function Ae(v,y){const E=y>>5;y%=32;const S=v.g.length-E,w=[];for(let D=0;D<S;D++)w[D]=y>0?v.i(D+E)>>>y|v.i(D+E+1)<<32-y:v.i(D+E);return new o(w,v.h)}(r=o.prototype).m=function(){if(G(this))return-U(this).m();let v=0,y=1;for(let E=0;E<this.g.length;E++){const S=this.i(E);v+=(S>=0?S:4294967296+S)*y,y*=4294967296}return v},r.toString=function(v){if((v=v||10)<2||36<v)throw Error("radix out of range: "+v);if(L(this))return"0";if(G(this))return"-"+U(this).toString(v);const y=h(Math.pow(v,6));var E=this;let S="";for(;;){const w=Ie(E,y).g;let D=(((E=X(E,w.j(y))).g.length>0?E.g[0]:E.h)>>>0).toString(v);if(L(E=w))return D+S;for(;D.length<6;)D="0"+D;S=D+S}},r.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h},r.l=function(v){return G(v=X(this,v))?-1:L(v)?0:1},r.abs=function(){return G(this)?U(this):this},r.add=function(v){const y=Math.max(this.g.length,v.g.length),E=[];let S=0;for(let w=0;w<=y;w++){let D=S+(65535&this.i(w))+(65535&v.i(w)),T=(D>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);S=T>>>16,D&=65535,T&=65535,E[w]=T<<16|D}return new o(E,-2147483648&E[E.length-1]?-1:0)},r.j=function(v){if(L(this)||L(v))return p;if(G(this))return G(v)?U(this).j(U(v)):U(U(this).j(v));if(G(v))return U(this.j(U(v)));if(this.l(x)<0&&v.l(x)<0)return h(this.m()*v.m());const y=this.g.length+v.g.length,E=[];for(var S=0;S<2*y;S++)E[S]=0;for(S=0;S<this.g.length;S++)for(let w=0;w<v.g.length;w++){const D=this.i(S)>>>16,T=65535&this.i(S),kt=v.i(w)>>>16,qn=65535&v.i(w);E[2*S+2*w]+=T*qn,ce(E,2*S+2*w),E[2*S+2*w+1]+=D*qn,ce(E,2*S+2*w+1),E[2*S+2*w+1]+=T*kt,ce(E,2*S+2*w+1),E[2*S+2*w+2]+=D*kt,ce(E,2*S+2*w+2)}for(v=0;v<y;v++)E[v]=E[2*v+1]<<16|E[2*v];for(v=y;v<2*y;v++)E[v]=0;return new o(E,0)},r.B=function(v){return Ie(this,v).h},r.and=function(v){const y=Math.max(this.g.length,v.g.length),E=[];for(let S=0;S<y;S++)E[S]=this.i(S)&v.i(S);return new o(E,this.h&v.h)},r.or=function(v){const y=Math.max(this.g.length,v.g.length),E=[];for(let S=0;S<y;S++)E[S]=this.i(S)|v.i(S);return new o(E,this.h|v.h)},r.xor=function(v){const y=Math.max(this.g.length,v.g.length),E=[];for(let S=0;S<y;S++)E[S]=this.i(S)^v.i(S);return new o(E,this.h^v.h)},n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,st.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=function f(v,y){if(0==v.length)throw Error("number format error: empty string");if((y=y||10)<2||36<y)throw Error("radix out of range: "+y);if("-"==v.charAt(0))return U(f(v.substring(1),y));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const E=h(Math.pow(y,8));let S=p;for(let D=0;D<v.length;D+=8){var w=Math.min(8,v.length-D);const T=parseInt(v.substring(D,D+w),y);w<8?(w=h(Math.pow(y,w)),S=S.j(w).add(h(T))):(S=S.j(E),S=S.add(h(T)))}return S},ut=st.Integer=o}).apply(typeof Ye<"u"?Ye:typeof self<"u"?self:typeof window<"u"?window:{});var re,Ve,Ut,Me,ue,we,Ze,dt,j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},q={};(function(){var r,e=Object.defineProperty,n=function t(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof j&&j];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var m=0;m<a.length-1;m++){var V=a[m];if(!(V in d))break e;d=d[V]}(l=l(m=d[a=a[a.length-1]]))!=m&&null!=l&&e(d,a,{configurable:!0,writable:!0,value:l})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(l){var m,d=[];for(m in l)Object.prototype.hasOwnProperty.call(l,m)&&d.push([m,l[m]]);return d}});var s=s||{},o=this||self;function u(a){var l=typeof a;return"object"==l&&null!=a||"function"==l}function c(a,l,d){return a.call.apply(a.bind,arguments)}function h(a,l,d){return(h=c).apply(null,arguments)}function f(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),a.apply(this,m)}}function p(a,l){function d(){}d.prototype=l.prototype,a.Z=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(m,V,k){for(var Q=Array(arguments.length-2),ge=2;ge<arguments.length;ge++)Q[ge-2]=arguments[ge];return l.prototype[V].apply(m,Q)}}var I=typeof AsyncContext<"u"&&"function"==typeof AsyncContext.Snapshot?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function x(a){const l=a.length;if(l>0){const d=Array(l);for(let m=0;m<l;m++)d[m]=a[m];return d}return[]}function L(a,l){for(let m=1;m<arguments.length;m++){const V=arguments[m];var d=typeof V;if("array"==(d="object"!=d?d:V?Array.isArray(V)?"array":d:"null")||"object"==d&&"number"==typeof V.length){const k=V.length||0;a.length=(d=a.length||0)+k;for(let Q=0;Q<k;Q++)a[d+Q]=V[Q]}else a.push(V)}}function U(a){o.setTimeout(()=>{throw a},0)}function X(){var a=v;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}var ne=new class G{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new Ie,a=>a.reset());class Ie{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Ae=!1,v=new class ce{constructor(){this.h=this.g=null}add(l,d){const m=ne.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}},y=()=>{const a=Promise.resolve(void 0);Ee=()=>{a.then(E)}};function E(){for(var a;a=X();){try{a.h.call(a.g)}catch(d){U(d)}var l=ne;l.j(a),l.h<100&&(l.h++,a.next=l.g,l.g=a)}Ae=!1}function S(){this.u=this.u,this.C=this.C}function w(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},w.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const d=()=>{};o.addEventListener("test",d,l),o.removeEventListener("test",d,l)}catch{}return a}();function T(a){return/^[\s\xa0]*$/.test(a)}function kt(a,l){w.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,l)}p(kt,w),kt.prototype.init=function(a,l){const d=this.type=a.type,m=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=l,(l=a.relatedTarget)||("mouseover"==d?l=a.fromElement:"mouseout"==d&&(l=a.toElement)),this.relatedTarget=l,m?(this.clientX=void 0!==m.clientX?m.clientX:m.pageX,this.clientY=void 0!==m.clientY?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&kt.Z.h.call(this)},kt.prototype.h=function(){kt.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var qn="closure_listenable_"+(1e6*Math.random()|0),py=0;function gy(a,l,d,m,V){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=V,this.key=++py,this.da=this.fa=!1}function Fo(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Lo(a,l,d){for(const m in a)l.call(d,a[m],m,a)}function Of(a){const l={};for(const d in a)l[d]=a[d];return l}const Ff="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Lf(a,l){let d,m;for(let V=1;V<arguments.length;V++){for(d in m=arguments[V],m)a[d]=m[d];for(let k=0;k<Ff.length;k++)d=Ff[k],Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}}function Bo(a){this.src=a,this.g={},this.h=0}function Rc(a,l){const d=l.type;if(d in a.g){var k,m=a.g[d],V=Array.prototype.indexOf.call(m,l,void 0);(k=V>=0)&&Array.prototype.splice.call(m,V,1),k&&(Fo(l),0==a.g[d].length&&(delete a.g[d],a.h--))}}function Sc(a,l,d,m){for(let V=0;V<a.length;++V){const k=a[V];if(!k.da&&k.listener==l&&k.capture==!!d&&k.ha==m)return V}return-1}Bo.prototype.add=function(a,l,d,m,V){const k=a.toString();(a=this.g[k])||(a=this.g[k]=[],this.h++);const Q=Sc(a,l,m,V);return Q>-1?(l=a[Q],d||(l.fa=!1)):((l=new gy(l,this.src,k,!!m,V)).fa=d,a.push(l)),l};var Pc="closure_lm_"+(1e6*Math.random()|0),Vc={};function Bf(a,l,d,m,V){if(m&&m.once)return qf(a,l,d,m,V);if(Array.isArray(l)){for(let k=0;k<l.length;k++)Bf(a,l[k],d,m,V);return null}return d=Nc(d),a&&a[qn]?a.J(l,d,u(m)?!!m.capture:!!m,V):Uf(a,l,d,!1,m,V)}function Uf(a,l,d,m,V,k){if(!l)throw Error("Invalid event type");const Q=u(V)?!!V.capture:!!V;let ge=xc(a);if(ge||(a[Pc]=ge=new Bo(a)),(d=ge.add(l,d,m,Q,k)).proxy)return d;if(m=function yy(){const l=Iy;return function a(d){return l.call(a.src,a.listener,d)}}(),d.proxy=m,m.src=a,m.listener=d,a.addEventListener)D||(V=Q),void 0===V&&(V=!1),a.addEventListener(l.toString(),m,V);else if(a.attachEvent)a.attachEvent(jf(l.toString()),m);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(m)}return d}function qf(a,l,d,m,V){if(Array.isArray(l)){for(let k=0;k<l.length;k++)qf(a,l[k],d,m,V);return null}return d=Nc(d),a&&a[qn]?a.K(l,d,u(m)?!!m.capture:!!m,V):Uf(a,l,d,!0,m,V)}function Gf(a,l,d,m,V){if(Array.isArray(l))for(var k=0;k<l.length;k++)Gf(a,l[k],d,m,V);else m=u(m)?!!m.capture:!!m,d=Nc(d),a&&a[qn]?(a=a.i,(k=String(l).toString())in a.g&&(d=Sc(l=a.g[k],d,m,V))>-1&&(Fo(l[d]),Array.prototype.splice.call(l,d,1),0==l.length&&(delete a.g[k],a.h--))):a&&(a=xc(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Sc(l,d,m,V)),(d=a>-1?l[a]:null)&&Cc(d))}function Cc(a){if("number"!=typeof a&&a&&!a.da){var l=a.src;if(l&&l[qn])Rc(l.i,a);else{var d=a.type,m=a.proxy;l.removeEventListener?l.removeEventListener(d,m,a.capture):l.detachEvent?l.detachEvent(jf(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=xc(l))?(Rc(d,a),0==d.h&&(d.src=null,l[Pc]=null)):Fo(a)}}}function jf(a){return a in Vc?Vc[a]:Vc[a]="on"+a}function Iy(a,l){if(a.da)a=!0;else{l=new kt(l,this);const d=a.listener,m=a.ha||a.src;a.fa&&Cc(a),a=d.call(m,l)}return a}function xc(a){return(a=a[Pc])instanceof Bo?a:null}var Dc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Nc(a){return"function"==typeof a?a:(a[Dc]||(a[Dc]=function(l){return a.handleEvent(l)}),a[Dc])}function vt(){S.call(this),this.i=new Bo(this),this.M=this,this.G=null}function Vt(a,l){var d,m=a.G;if(m)for(d=[];m;m=m.G)d.push(m);if(a=a.M,m=l.type||l,"string"==typeof l)l=new w(l,a);else if(l instanceof w)l.target=l.target||a;else{var V=l;Lf(l=new w(m,a),V)}let k,Q;if(V=!0,d)for(Q=d.length-1;Q>=0;Q--)k=l.g=d[Q],V=Uo(k,m,!0,l)&&V;if(k=l.g=a,V=Uo(k,m,!0,l)&&V,V=Uo(k,m,!1,l)&&V,d)for(Q=0;Q<d.length;Q++)k=l.g=d[Q],V=Uo(k,m,!1,l)&&V}function Uo(a,l,d,m){if(!(l=a.i.g[String(l)]))return!0;l=l.concat();let V=!0;for(let k=0;k<l.length;++k){const Q=l[k];if(Q&&!Q.da&&Q.capture==d){const ge=Q.listener,at=Q.ha||Q.src;Q.fa&&Rc(a.i,Q),V=!1!==ge.call(at,m)&&V}}return V&&!m.defaultPrevented}function zf(a){a.g=function Ty(a,l){if("function"!=typeof a){if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=h(a.handleEvent,a)}return Number(l)>2147483647?-1:o.setTimeout(a,l||0)}(()=>{a.g=null,a.i&&(a.i=!1,zf(a))},a.l);const l=a.h;a.h=null,a.m.apply(null,l)}p(vt,S),vt.prototype[qn]=!0,vt.prototype.removeEventListener=function(a,l,d,m){Gf(this,a,l,d,m)},vt.prototype.N=function(){if(vt.Z.N.call(this),this.i){var a=this.i;for(const l in a.g){const d=a.g[l];for(let m=0;m<d.length;m++)Fo(d[m]);delete a.g[l],a.h--}}this.G=null},vt.prototype.J=function(a,l,d,m){return this.i.add(String(a),l,!1,d,m)},vt.prototype.K=function(a,l,d,m){return this.i.add(String(a),l,!0,d,m)};class Ey extends S{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:zf(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function cs(a){S.call(this),this.h=a,this.g={}}p(cs,S);var $f=[];function Kf(a){Lo(a.g,function(l,d){this.g.hasOwnProperty(d)&&Cc(l)},a),a.g={}}cs.prototype.N=function(){cs.Z.N.call(this),Kf(this)},cs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var kc=o.JSON.stringify,Ay=o.JSON.parse,vy=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Qf(){}function Wf(){}var ls={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Mc(){w.call(this,"d")}function Oc(){w.call(this,"c")}p(Mc,w),p(Oc,w);var vr={},Hf=null;function qo(){return Hf=Hf||new vt}function Jf(a){w.call(this,vr.Ia,a)}function hs(a){const l=qo();Vt(l,new Jf(l))}function Xf(a,l){w.call(this,vr.STAT_EVENT,a),this.stat=l}function Ct(a){const l=qo();Vt(l,new Xf(l,a))}function Yf(a,l){w.call(this,vr.Ja,a),this.size=l}function ds(a,l){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},l)}function fs(){this.g=!0}function yi(a,l,d,m){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+function Sy(a,l){if(!a.g)return l;if(!l)return null;try{const k=JSON.parse(l);if(k)for(a=0;a<k.length;a++)if(Array.isArray(k[a])){var d=k[a];if(!(d.length<2)){var m=d[1];if(Array.isArray(m)&&!(m.length<1)){var V=m[0];if("noop"!=V&&"stop"!=V&&"close"!=V)for(let Q=1;Q<m.length;Q++)m[Q]=""}}}return kc(k)}catch{return l}}(a,d)+(m?" "+m:"")})}vr.Ia="serverreachability",p(Jf,w),vr.STAT_EVENT="statevent",p(Xf,w),vr.Ja="timingevent",p(Yf,w),fs.prototype.ua=function(){this.g=!1},fs.prototype.info=function(){};var em,Go={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Zf={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Fc(){}function ms(a){return encodeURIComponent(String(a))}function Py(a){var l=1;a=a.split(":");const d=[];for(;l>0&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function Gn(a,l,d,m){this.j=a,this.i=l,this.l=d,this.S=m||1,this.V=new cs(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new tm}function tm(){this.i=null,this.g="",this.h=!1}p(Fc,Qf),Fc.prototype.g=function(){return new XMLHttpRequest},em=new Fc;var nm={},Lc={};function Bc(a,l,d){a.M=1,a.A=zo(an(l)),a.u=d,a.R=!0,rm(a,null)}function rm(a,l){a.F=Date.now(),jo(a),a.B=an(a.A);var d=a.B,m=a.S;Array.isArray(m)||(m=[String(m)]),gm(d.i,"t",m),a.C=0,d=a.j.L,a.h=new tm,a.g=km(a.j,d?l:null,!a.u),a.P>0&&(a.O=new Ey(h(a.Y,a,a.g),a.P)),l=a.V,d=a.g,m=a.ba;var V="readystatechange";Array.isArray(V)||(V&&($f[0]=V.toString()),V=$f);for(let k=0;k<V.length;k++){const Q=Bf(d,V[k],m||l.handleEvent,!1,l.h||l);if(!Q)break;l.g[Q.key]=Q}l=a.J?Of(a.J):{},a.u?(a.v||(a.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,l)):(a.v="GET",a.g.ea(a.B,a.v,null,l)),hs(),function wy(a,l,d,m,V,k){a.info(function(){if(a.g)if(k){var Q="",ge=k.split("&");for(let ke=0;ke<ge.length;ke++){var at=ge[ke].split("=");if(at.length>1){const ht=at[0];at=at[1];const un=ht.split("_");Q=un.length>=2&&"type"==un[1]?Q+(ht+"=")+at+"&":Q+(ht+"=redacted&")}}}else Q=null;else Q=k;return"XMLHTTP REQ ("+m+") [attempt "+V+"]: "+l+"\n"+d+"\n"+Q})}(a.i,a.v,a.B,a.l,a.S,a.u)}function im(a){return!!a.g&&"GET"==a.v&&2!=a.M&&a.j.Aa}function Cy(a,l){var d=a.C,m=l.indexOf("\n",d);return-1==m?Lc:(d=Number(l.substring(d,m)),isNaN(d)?nm:(m+=1)+d>l.length?Lc:(l=l.slice(m,m+d),a.C=m+d,l))}function jo(a){a.T=Date.now()+a.H,sm(a,a.H)}function sm(a,l){if(null!=a.D)throw Error("WatchDog timer not null");a.D=ds(h(a.aa,a),l)}function Uc(a){a.D&&(o.clearTimeout(a.D),a.D=null)}function ps(a){0==a.j.I||a.K||Cm(a.j,a)}function wr(a){Uc(a);var l=a.O;l&&"function"==typeof l.dispose&&l.dispose(),a.O=null,Kf(a.V),a.g&&(l=a.g,a.g=null,l.abort(),l.dispose())}function qc(a,l){try{var d=a.j;if(0!=d.I&&(d.g==a||Gc(d.h,a)))if(!a.L&&Gc(d.h,a)&&3==d.I){try{var m=d.Ba.g.parse(l)}catch{m=null}if(Array.isArray(m)&&3==m.length){var V=m;if(0==V[0]){e:if(!d.v){if(d.g){if(!(d.g.F+3e3<a.F))break e;Jo(d),Wo(d)}Qc(d),Ct(18)}}else d.xa=V[1],0<d.xa-d.K&&V[2]<37500&&d.F&&0==d.A&&!d.C&&(d.C=ds(h(d.Va,d),6e3));um(d.h)<=1&&d.ta&&(d.ta=void 0)}else Rr(d,11)}else if((a.L||d.g==a)&&Jo(d),!T(l))for(V=d.Ba.g.parse(l),l=0;l<V.length;l++){let ke=V[l];const ht=ke[0];if(!(ht<=d.K))if(d.K=ht,ke=ke[1],2==d.I)if("c"==ke[0]){d.M=ke[1],d.ba=ke[2];const un=ke[3];null!=un&&(d.ka=un,d.j.info("VER="+d.ka));const Sr=ke[4];null!=Sr&&(d.za=Sr,d.j.info("SVER="+d.za));const Kn=ke[5];null!=Kn&&"number"==typeof Kn&&Kn>0&&(d.O=m=1.5*Kn,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;const Qn=a.g;if(Qn){const Yo=Qn.g?Qn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Yo){var k=m.h;k.g||-1==Yo.indexOf("spdy")&&-1==Yo.indexOf("quic")&&-1==Yo.indexOf("h2")||(k.j=k.l,k.g=new Set,k.h&&(jc(k,k.h),k.h=null))}if(m.G){const Hc=Qn.g?Qn.g.getResponseHeader("X-HTTP-Session-Id"):null;Hc&&(m.wa=Hc,Be(m.J,m.G,Hc))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms"));var Q=a;if((m=d).na=Nm(m,m.L?m.ba:null,m.W),Q.L){cm(m.h,Q);var ge=Q,at=m.O;at&&(ge.H=at),ge.D&&(Uc(ge),jo(ge)),m.g=Q}else Pm(m);d.i.length>0&&Ho(d)}else"stop"!=ke[0]&&"close"!=ke[0]||Rr(d,7);else 3==d.I&&("stop"==ke[0]||"close"==ke[0]?"stop"==ke[0]?Rr(d,7):Kc(d):"noop"!=ke[0]&&d.l&&d.l.qa(ke),d.A=0)}hs()}catch{}}function om(a){this.l=a||10,a=o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation")).length>0&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function am(a){return!!a.h||!!a.g&&a.g.size>=a.j}function um(a){return a.h?1:a.g?a.g.size:0}function Gc(a,l){return a.h?a.h==l:!!a.g&&a.g.has(l)}function jc(a,l){a.g?a.g.add(l):a.h=l}function cm(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}function lm(a){if(null!=a.h)return a.i.concat(a.h.G);if(null!=a.g&&0!==a.g.size){let l=a.i;for(const d of a.g.values())l=l.concat(d.G);return l}return x(a.i)}Gn.prototype.ba=function(a){a=a.target;const l=this.O;l&&3==$n(a)?l.j():this.Y(a)},Gn.prototype.Y=function(a){try{if(a==this.g)e:{const ge=$n(this.g),at=this.g.ya();if(this.g.ca(),!(ge<3)&&(3!=ge||this.g&&(this.h.h||this.g.la()||vm(this.g)))){this.K||4!=ge||7==at||hs(),Uc(this);var l=this.g.ca();this.X=l;var d=function Vy(a){if(!im(a))return a.g.la();const l=vm(a.g);if(""===l)return"";let d="";const m=l.length,V=4==$n(a.g);if(!a.h.i){if(typeof TextDecoder>"u")return wr(a),ps(a),"";a.h.i=new o.TextDecoder}for(let k=0;k<m;k++)a.h.h=!0,d+=a.h.i.decode(l[k],{stream:!(V&&k==m-1)});return l.length=0,a.h.g+=d,a.C=0,a.h.g}(this);if(this.o=200==l,function by(a,l,d,m,V,k,Q){a.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+V+"]: "+l+"\n"+d+"\n"+k+" "+Q})}(this.i,this.v,this.B,this.l,this.S,ge,l),this.o){if(this.U&&!this.L){t:{if(this.g){var m,V=this.g;if((m=V.g?V.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(m)){var k=m;break t}}k=null}if(!(a=k)){this.o=!1,this.m=3,Ct(12),wr(this),ps(this);break e}yi(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qc(this,a)}if(this.R){let ht;for(a=!0;!this.K&&this.C<d.length;){if(ht=Cy(this,d),ht==Lc){4==ge&&(this.m=4,Ct(14),a=!1),yi(this.i,this.l,null,"[Incomplete Response]");break}if(ht==nm){this.m=4,Ct(15),yi(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}yi(this.i,this.l,ht,null),qc(this,ht)}if(im(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=ge||0!=d.length||this.h.h||(this.m=1,Ct(16),a=!1),this.o=this.o&&a,a){if(d.length>0&&!this.W){this.W=!0;var Q=this.j;Q.g==this&&Q.aa&&!Q.P&&(Q.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Wc(Q),Q.P=!0,Ct(11))}}else yi(this.i,this.l,d,"[Invalid Chunked Response]"),wr(this),ps(this)}else yi(this.i,this.l,d,null),qc(this,d);4==ge&&wr(this),this.o&&!this.K&&(4==ge?Cm(this.j,this):(this.o=!1,jo(this)))}else(function zy(a){const l={};a=(a.g&&$n(a)>=2&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let m=0;m<a.length;m++){if(T(a[m]))continue;var d=Py(a[m]);const V=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const k=l[V]||[];l[V]=k,k.push(d)}!function _y(a,l){for(const d in a)l.call(void 0,a[d],d,a)}(l,function(m){return m.join(", ")})})(this.g),400==l&&d.indexOf("Unknown SID")>0?(this.m=3,Ct(12)):(this.m=0,Ct(13)),wr(this),ps(this)}}}catch{}},Gn.prototype.cancel=function(){this.K=!0,wr(this)},Gn.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(function Ry(a,l){a.info(function(){return"TIMEOUT: "+l})}(this.i,this.B),2!=this.M&&(hs(),Ct(17)),wr(this),this.m=2,ps(this)):sm(this,this.T-a)},om.prototype.cancel=function(){if(this.i=lm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var hm=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jn(a){let l;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,a instanceof jn?(this.l=a.l,gs(this,a.j),this.o=a.o,this.g=a.g,_s(this,a.u),this.h=a.h,zc(this,_m(a.i)),this.m=a.m):a&&(l=String(a).match(hm))?(this.l=!1,gs(this,l[1]||"",!0),this.o=ys(l[2]||""),this.g=ys(l[3]||"",!0),_s(this,l[4]),this.h=ys(l[5]||"",!0),zc(this,l[6]||"",!0),this.m=ys(l[7]||"")):(this.l=!1,this.i=new Ts(null,this.l))}function an(a){return new jn(a)}function gs(a,l,d){a.j=d?ys(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function _s(a,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);a.u=l}else a.u=null}function zc(a,l,d){l instanceof Ts?(a.i=l,function Ly(a,l){l&&!a.j&&(br(a),a.i=null,a.g.forEach(function(d,m){const V=m.toLowerCase();m!=V&&(fm(this,m),gm(this,V,d))},a)),a.j=l}(a.i,a.l)):(d||(l=Is(l,Oy)),a.i=new Ts(l,a.l))}function Be(a,l,d){a.i.set(l,d)}function zo(a){return Be(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function ys(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Is(a,l,d){return"string"==typeof a?(a=encodeURI(a).replace(l,Ny),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Ny(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}jn.prototype.toString=function(){const a=[];var l=this.j;l&&a.push(Is(l,dm,!0),":");var d=this.g;return(d||"file"==l)&&(a.push("//"),(l=this.o)&&a.push(Is(l,dm,!0),"@"),a.push(ms(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.u)&&a.push(":",String(d))),(d=this.h)&&(this.g&&"/"!=d.charAt(0)&&a.push("/"),a.push(Is(d,"/"==d.charAt(0)?My:ky,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Is(d,Fy)),a.join("")},jn.prototype.resolve=function(a){const l=an(this);let d=!!a.j;d?gs(l,a.j):d=!!a.o,d?l.o=a.o:d=!!a.g,d?l.g=a.g:d=null!=a.u;var m=a.h;if(d)_s(l,a.u);else if(d=!!a.h){if("/"!=m.charAt(0))if(this.g&&!this.h)m="/"+m;else{var V=l.h.lastIndexOf("/");-1!=V&&(m=l.h.slice(0,V+1)+m)}if(".."==(V=m)||"."==V)m="";else if(-1!=V.indexOf("./")||-1!=V.indexOf("/.")){m=0==V.lastIndexOf("/",0),V=V.split("/");const k=[];for(let Q=0;Q<V.length;){const ge=V[Q++];"."==ge?m&&Q==V.length&&k.push(""):".."==ge?((k.length>1||1==k.length&&""!=k[0])&&k.pop(),m&&Q==V.length&&k.push("")):(k.push(ge),m=!0)}m=k.join("/")}else m=V}return d?l.h=m:d=""!==a.i.toString(),d?zc(l,_m(a.i)):d=!!a.m,d&&(l.m=a.m),l};var dm=/[#\/\?@]/g,ky=/[#\?:]/g,My=/[#\?]/g,Oy=/[#\?@]/g,Fy=/#/g;function Ts(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function br(a){a.g||(a.g=new Map,a.h=0,a.i&&function Dy(a,l){if(a){a=a.split("&");for(let d=0;d<a.length;d++){const m=a[d].indexOf("=");let V,k=null;m>=0?(V=a[d].substring(0,m),k=a[d].substring(m+1)):V=a[d],l(V,k?decodeURIComponent(k.replace(/\+/g," ")):"")}}}(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function fm(a,l){br(a),l=Ii(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function mm(a,l){return br(a),l=Ii(a,l),a.g.has(l)}function pm(a,l){br(a);let d=[];if("string"==typeof l)mm(a,l)&&(d=d.concat(a.g.get(Ii(a,l))));else for(a=Array.from(a.g.values()),l=0;l<a.length;l++)d=d.concat(a[l]);return d}function gm(a,l,d){fm(a,l),d.length>0&&(a.i=null,a.g.set(Ii(a,l),x(d)),a.h+=d.length)}function _m(a){const l=new Ts;return l.i=a.i,a.g&&(l.g=new Map(a.g),l.h=a.h),l}function Ii(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function zn(a,l,d,m,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),m(d)}catch{}}function qy(){this.g=new vy}function $o(a){this.i=a.Sb||null,this.h=a.ab||!1}function Ko(a,l){vt.call(this),this.H=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function ym(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}function Es(a){a.readyState=4,a.l=null,a.j=null,a.B=null,As(a)}function As(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function Im(a){let l="";return Lo(a,function(d,m){l+=m,l+=":",l+=d,l+="\r\n"}),l}function $c(a,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=Im(d),"string"==typeof a?null!=d&&ms(d):Be(a,l,d))}function Xe(a){vt.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(r=Ts.prototype).add=function(a,l){br(this),this.i=null,a=Ii(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this},r.forEach=function(a,l){br(this),this.g.forEach(function(d,m){d.forEach(function(V){a.call(l,V,m,this)},this)},this)},r.set=function(a,l){return br(this),this.i=null,mm(this,a=Ii(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a&&(a=pm(this,a)).length>0?String(a[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],l=Array.from(this.g.keys());for(let m=0;m<l.length;m++){var d=l[m];const V=ms(d);d=pm(this,d);for(let k=0;k<d.length;k++){let Q=V;""!==d[k]&&(Q+="="+ms(d[k])),a.push(Q)}}return this.i=a.join("&")},p($o,Qf),$o.prototype.g=function(){return new Ko(this.i,this.h)},p(Ko,vt),(r=Ko.prototype).open=function(a,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=l,this.readyState=1,As(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(l.body=a),(this.H||o).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Es(this)),this.readyState=0},r.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,As(this)),this.g&&(this.readyState=3,As(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ym(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))},r.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?Es(this):As(this),3==this.readyState&&ym(this)}},r.Oa=function(a){this.g&&(this.response=this.responseText=a,Es(this))},r.Na=function(a){this.g&&(this.response=a,Es(this))},r.ga=function(){this.g&&Es(this)},r.setRequestHeader=function(a,l){this.A.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],l=this.h.entries();for(var d=l.next();!d.done;)a.push((d=d.value)[0]+": "+d[1]),d=l.next();return a.join("\r\n")},Object.defineProperty(Ko.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),p(Xe,vt);var Gy=/^https?$/i,jy=["POST","PUT"];function Tm(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.o=5,Em(a),Qo(a)}function Em(a){a.A||(a.A=!0,Vt(a,"complete"),Vt(a,"error"))}function Am(a){if(a.h&&typeof s<"u")if(a.v&&4==$n(a))setTimeout(a.Ca.bind(a),0);else if(Vt(a,"readystatechange"),4==$n(a)){a.h=!1;try{const k=a.ca();e:switch(k){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=0===k){let Q=String(a.D).match(hm)[1]||null;!Q&&o.self&&o.self.location&&(Q=o.self.location.protocol.slice(0,-1)),m=!Gy.test(Q?Q.toLowerCase():"")}d=m}if(d)Vt(a,"complete"),Vt(a,"success");else{a.o=6;try{var V=$n(a)>2?a.g.statusText:""}catch{V=""}a.l=V+" ["+a.ca()+"]",Em(a)}}finally{Qo(a)}}}function Qo(a,l){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const d=a.g;a.g=null,l||Vt(a,"ready");try{d.onreadystatechange=null}catch{}}}function $n(a){return a.g?a.g.readyState:0}function vm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function vs(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function wm(a){this.za=0,this.i=[],this.j=new fs,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=vs("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=vs("baseRetryDelayMs",5e3,a),this.Za=vs("retryDelaySeedMs",1e4,a),this.Ta=vs("forwardChannelMaxRetries",2,a),this.va=vs("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new om(a&&a.concurrentRequestLimit),this.Ba=new qy,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Kc(a){if(bm(a),3==a.I){var l=a.V++,d=an(a.J);if(Be(d,"SID",a.M),Be(d,"RID",l),Be(d,"TYPE","terminate"),ws(a,d),(l=new Gn(a,a.j,l)).M=2,l.A=zo(an(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&o.Image&&((new Image).src=l.A,d=!0),d||(l.g=km(l.j,null),l.g.ea(l.A)),l.F=Date.now(),jo(l)}Dm(a)}function Wo(a){a.g&&(Wc(a),a.g.cancel(),a.g=null)}function bm(a){Wo(a),a.v&&(o.clearTimeout(a.v),a.v=null),Jo(a),a.h.cancel(),a.m&&("number"==typeof a.m&&o.clearTimeout(a.m),a.m=null)}function Ho(a){if(!am(a.h)&&!a.m){a.m=!0;var l=a.Ea;Ee||y(),Ae||(Ee(),Ae=!0),v.add(l,a),a.D=0}}function Rm(a,l){var d;d=l?l.l:a.V++;const m=an(a.J);Be(m,"SID",a.M),Be(m,"RID",d),Be(m,"AID",a.K),ws(a,m),a.u&&a.o&&$c(m,a.u,a.o),d=new Gn(a,a.j,d,a.D+1),null===a.u&&(d.J=a.o),l&&(a.i=l.G.concat(a.i)),l=Sm(a,d,1e3),d.H=Math.round(.5*a.va)+Math.round(.5*a.va*Math.random()),jc(a.h,d),Bc(d,m,l)}function ws(a,l){a.H&&Lo(a.H,function(d,m){Be(l,m,d)}),a.l&&Lo({},function(d,m){Be(l,m,d)})}function Sm(a,l,d){d=Math.min(a.i.length,d);const m=a.l?h(a.l.Ka,a.l,a):null;e:{var V=a.i;let ge=-1;for(;;){const at=["count="+d];-1==ge?d>0?(ge=V[0].g,at.push("ofs="+ge)):ge=0:at.push("ofs="+ge);let ke=!0;for(let ht=0;ht<d;ht++){var k=V[ht].g;const un=V[ht].map;if((k-=ge)<0)ge=Math.max(0,V[ht].g-100),ke=!1;else try{k="req"+k+"_"||0;try{var Q=un instanceof Map?un:Object.entries(un);for(const[Sr,Kn]of Q){let Qn=Kn;u(Kn)&&(Qn=kc(Kn)),at.push(k+Sr+"="+encodeURIComponent(Qn))}}catch(Sr){throw at.push(k+"type="+encodeURIComponent("_badmap")),Sr}}catch{m&&m(un)}}if(ke){Q=at.join("&");break e}}Q=void 0}return a=a.i.splice(0,d),l.G=a,Q}function Pm(a){if(!a.g&&!a.v){a.Y=1;var l=a.Da;Ee||y(),Ae||(Ee(),Ae=!0),v.add(l,a),a.A=0}}function Qc(a){return!(a.g||a.v||a.A>=3||(a.Y++,a.v=ds(h(a.Da,a),xm(a,a.A)),a.A++,0))}function Wc(a){null!=a.B&&(o.clearTimeout(a.B),a.B=null)}function Vm(a){a.g=new Gn(a,a.j,"rpc",a.Y),null===a.u&&(a.g.J=a.o),a.g.P=0;var l=an(a.na);Be(l,"RID","rpc"),Be(l,"SID",a.M),Be(l,"AID",a.K),Be(l,"CI",a.F?"0":"1"),!a.F&&a.ia&&Be(l,"TO",a.ia),Be(l,"TYPE","xmlhttp"),ws(a,l),a.u&&a.o&&$c(l,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=zo(an(l)),d.u=null,d.R=!0,rm(d,a)}function Jo(a){null!=a.C&&(o.clearTimeout(a.C),a.C=null)}function Cm(a,l){var d=null;if(a.g==l){Jo(a),Wc(a),a.g=null;var m=2}else{if(!Gc(a.h,l))return;d=l.G,cm(a.h,l),m=1}if(0!=a.I)if(l.o)if(1==m){d=l.u?l.u.length:0,l=Date.now()-l.F;var V=a.D;Vt(m=qo(),new Yf(m,d)),Ho(a)}else Pm(a);else if(3==(V=l.m)||0==V&&l.X>0||!(1==m&&function $y(a,l){return!(um(a.h)>=a.h.j-(a.m?1:0)||(a.m?(a.i=l.G.concat(a.i),0):1==a.I||2==a.I||a.D>=(a.Sa?0:a.Ta)||(a.m=ds(h(a.Ea,a,l),xm(a,a.D)),a.D++,0)))}(a,l)||2==m&&Qc(a)))switch(d&&d.length>0&&(l=a.h,l.i=l.i.concat(d)),V){case 1:Rr(a,5);break;case 4:Rr(a,10);break;case 3:Rr(a,6);break;default:Rr(a,2)}}function xm(a,l){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*l}function Rr(a,l){if(a.j.info("Error code "+l),2==l){var d=h(a.bb,a),m=a.Ua;const V=!m;m=new jn(m||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||gs(m,"https"),zo(m),V?function By(a,l){const d=new fs;if(o.Image){const m=new Image;m.onload=f(zn,d,"TestLoadImage: loaded",!0,l,m),m.onerror=f(zn,d,"TestLoadImage: error",!1,l,m),m.onabort=f(zn,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=f(zn,d,"TestLoadImage: timeout",!1,l,m),o.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=a}else l(!1)}(m.toString(),d):function Uy(a,l){new fs;const m=new AbortController,V=setTimeout(()=>{m.abort(),zn(0,0,!1,l)},1e4);fetch(a,{signal:m.signal}).then(k=>{clearTimeout(V),zn(0,0,!!k.ok,l)}).catch(()=>{clearTimeout(V),zn(0,0,!1,l)})}(m.toString(),d)}else Ct(2);a.I=0,a.l&&a.l.pa(l),Dm(a),bm(a)}function Dm(a){if(a.I=0,a.ja=[],a.l){const l=lm(a.h);(0!=l.length||0!=a.i.length)&&(L(a.ja,l),L(a.ja,a.i),a.h.i.length=0,x(a.i),a.i.length=0),a.l.oa()}}function Nm(a,l,d){var m=d instanceof jn?an(d):new jn(d);if(""!=m.g)l&&(m.g=l+"."+m.g),_s(m,m.u);else{var V=o.location;m=V.protocol,l=l?l+"."+V.hostname:V.hostname,V=+V.port;const k=new jn(null);m&&gs(k,m),l&&(k.g=l),V&&_s(k,V),d&&(k.h=d),m=k}return l=a.wa,(d=a.G)&&l&&Be(m,d,l),Be(m,"VER",a.ka),ws(a,m),m}function km(a,l,d){if(l&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new Xe(a.Aa&&!a.ma?new $o({ab:d}):a.ma)).Fa(a.L),l}function Mm(){}function Xo(){}function Bt(a,l){vt.call(this),this.g=new wm(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(a?a["X-WebChannel-Client-Profile"]=l.sa:a={"X-WebChannel-Client-Profile":l.sa}),this.g.U=a,(a=l&&l.Qb)&&!T(a)&&(this.g.u=a),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!T(l)&&(this.g.G=l,null!==(a=this.h)&&l in a&&l in(a=this.h)&&delete a[l]),this.j=new Ti(this)}function Om(a){Mc.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(const d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=null!==l&&a in l?l[a]:void 0),this.data=l}else this.data=a}function Fm(){Oc.call(this),this.status=1}function Ti(a){this.g=a}(r=Xe.prototype).Fa=function(a){this.H=a},r.ea=function(a,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():em.g(),this.g.onreadystatechange=I(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(k){return void Tm(this,k)}if(a=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var V in m)d.set(V,m[V]);else{if("function"!=typeof m.keys||"function"!=typeof m.get)throw Error("Unknown input type for opt_headers: "+String(m));for(const k of m.keys())d.set(k,m.get(k))}m=Array.from(d.keys()).find(k=>"content-type"==k.toLowerCase()),V=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(jy,l,void 0)>=0)||m||V||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[k,Q]of d)this.g.setRequestHeader(k,Q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(k){Tm(this,k)}},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,Vt(this,"complete"),Vt(this,"abort"),Qo(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Qo(this,!0)),Xe.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?Am(this):this.Xa())},r.Xa=function(){Am(this)},r.isActive=function(){return!!this.g},r.ca=function(){try{return $n(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(a){if(this.g){var l=this.g.responseText;return a&&0==l.indexOf(a)&&(l=l.substring(a.length)),Ay(l)}},r.ya=function(){return this.o},r.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=wm.prototype).ka=8,r.I=1,r.connect=function(a,l,d,m){Ct(0),this.W=a,this.H=l||{},d&&void 0!==m&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.J=Nm(this,null,this.W),Ho(this)},r.Ea=function(a){if(this.m)if(this.m=null,1==this.I){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const V=new Gn(this,this.j,a);let k=this.o;if(this.U&&(k?(k=Of(k),Lf(k,this.U)):k=this.U),null!==this.u||this.R||(V.J=k,k=null),this.S)e:{for(var l=0,d=0;d<this.i.length;d++){var m=this.i[d];if(void 0===(m="__data__"in m.map&&"string"==typeof(m=m.map.__data__)?m.length:void 0))break;if((l+=m)>4096){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Sm(this,V,l),Be(d=an(this.J),"RID",a),Be(d,"CVER",22),this.G&&Be(d,"X-HTTP-Session-Id",this.G),ws(this,d),k&&(this.R?l="headers="+ms(Im(k))+"&"+l:this.u&&$c(d,this.u,k)),jc(this.h,V),this.Ra&&Be(d,"TYPE","init"),this.S?(Be(d,"$req",l),Be(d,"SID","null"),V.U=!0,Bc(V,d,null)):Bc(V,d,l),this.I=2}}else 3==this.I&&(a?Rm(this,a):0==this.i.length||am(this.h)||Rm(this))},r.Da=function(){if(this.v=null,Vm(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=ds(h(this.Wa,this),a)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ct(10),Wo(this),Vm(this))},r.Va=function(){null!=this.C&&(this.C=null,Wo(this),Qc(this),Ct(19))},r.bb=function(a){a?(this.j.info("Successfully pinged google.com"),Ct(2)):(this.j.info("Failed to ping google.com"),Ct(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=Mm.prototype).ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){},Xo.prototype.g=function(a,l){return new Bt(a,l)},p(Bt,vt),Bt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Bt.prototype.close=function(){Kc(this.g)},Bt.prototype.o=function(a){var l=this.g;if("string"==typeof a){var d={};d.__data__=a,a=d}else this.v&&((d={}).__data__=kc(a),a=d);l.i.push(new class{constructor(a,l){this.g=a,this.map=l}}(l.Ya++,a)),3==l.I&&Ho(l)},Bt.prototype.N=function(){this.g.l=null,delete this.j,Kc(this.g),delete this.g,Bt.Z.N.call(this)},p(Om,Mc),p(Fm,Oc),p(Ti,Mm),Ti.prototype.ra=function(){Vt(this.g,"a")},Ti.prototype.qa=function(a){Vt(this.g,new Om(a))},Ti.prototype.pa=function(a){Vt(this.g,new Fm)},Ti.prototype.oa=function(){Vt(this.g,"b")},Xo.prototype.createWebChannel=Xo.prototype.g,Bt.prototype.send=Bt.prototype.o,Bt.prototype.open=Bt.prototype.m,Bt.prototype.close=Bt.prototype.close,dt=q.createWebChannelTransport=function(){return new Xo},Ze=q.getStatEventTarget=function(){return qo()},we=q.Event=vr,ue=q.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Go.NO_ERROR=0,Go.TIMEOUT=8,Go.HTTP_ERROR=6,Me=q.ErrorCode=Go,Zf.COMPLETE="complete",Ut=q.EventType=Zf,Wf.EventType=ls,ls.OPEN="a",ls.CLOSE="b",ls.ERROR="c",ls.MESSAGE="d",vt.prototype.listen=vt.prototype.J,Ve=q.WebChannel=Wf,q.FetchXmlHttpFactory=$o,Xe.prototype.listenOnce=Xe.prototype.K,Xe.prototype.getLastError=Xe.prototype.Ha,Xe.prototype.getLastErrorCode=Xe.prototype.ya,Xe.prototype.getStatus=Xe.prototype.ca,Xe.prototype.getResponseJson=Xe.prototype.La,Xe.prototype.getResponseText=Xe.prototype.la,Xe.prototype.send=Xe.prototype.ea,Xe.prototype.setWithCredentials=Xe.prototype.Fa,re=q.XhrIo=Xe}).apply(typeof j<"u"?j:typeof self<"u"?self:typeof window<"u"?window:{});const gt="@firebase/firestore";class We{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}We.UNAUTHENTICATED=new We(null),We.GOOGLE_CREDENTIALS=new We("google-credentials-uid"),We.FIRST_PARTY=new We("first-party-uid"),We.MOCK_USER=new We("mock-user");let In="12.3.0";const Mt=new he.Yd("@firebase/firestore");function Gt(){return Mt.logLevel}function B(r,...e){if(Mt.logLevel<=he.in.DEBUG){const t=e.map(Kt);Mt.debug(`Firestore (${In}): ${r}`,...t)}}function Fe(r,...e){if(Mt.logLevel<=he.in.ERROR){const t=e.map(Kt);Mt.error(`Firestore (${In}): ${r}`,...t)}}function tt(r,...e){if(Mt.logLevel<=he.in.WARN){const t=e.map(Kt);Mt.warn(`Firestore (${In}): ${r}`,...t)}}function Kt(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function W(r,e,t){let n="Unexpected state";"string"==typeof e?n=e:t=e,bt(r,n,t)}function bt(r,e,t){let n=`FIRESTORE (${In}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(void 0!==t)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Fe(n),new Error(n)}function J(r,e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,r||bt(e,i,n)}function $(r,e){return r}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends ve.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class He{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ei{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class bs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(We.UNAUTHENTICATED))}shutdown(){}}class Rs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ss{constructor(e){this.t=e,this.currentUser=We.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;J(void 0===this.o,42304);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let o=new He;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new He,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=o;e.enqueueRetryable((0,H.Z)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new He)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(J("string"==typeof n.accessToken,31837,{l:n}),new Ei(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return J(null===e||"string"==typeof e,2055,{h:e}),new We(e)}}class Ps{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=We.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Vs{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Ps(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(We.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ai{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,Y.rh)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){J(void 0===this.o,3512);const n=s=>{null!=s.error&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,B("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Vr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(J("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Vr(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function vi(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class Hn{static newId(){const t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const i=vi(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function se(r,e){return r<e?-1:r>e?1:0}function Jn(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const i=r.charAt(n),s=e.charAt(n);if(i!==s)return Xn(i)===Xn(s)?se(i,s):Xn(i)?1:-1}return se(r.length,e.length)}const En=55296,Cr=57343;function Xn(r){const e=r.charCodeAt(0);return e>=En&&e<=Cr}function Qt(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}const xr="__name__";class ft{constructor(e,t,n){void 0===t?t=0:t>e.length&&W(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&W(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ft.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ft?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=ft.compareSegments(e.get(i),t.get(i));if(0!==s)return s}return se(e.length,t.length)}static compareSegments(e,t){const n=ft.isNumericId(e),i=ft.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?ft.extractNumericId(e).compare(ft.extractNumericId(t)):Jn(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ut.fromString(e.substring(4,e.length-2))}}class me extends ft{construct(e,t,n){return new me(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new F(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new me(t)}static emptyPath(){return new me([])}}const Zn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xe extends ft{construct(e,t,n){return new xe(e,t,n)}static isValidIdentifier(e){return Zn.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===xr}static keyField(){return new xe([xr])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new F(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new F(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new F(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(o=!o,i++):"."!==u||o?(n+=u,i++):(s(),i++)}if(s(),o)throw new F(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new xe(t)}static emptyPath(){return new xe([])}}class z{constructor(e){this.path=e}static fromPath(e){return new z(me.fromString(e))}static fromName(e){return new z(me.fromString(e).popFirst(5))}static empty(){return new z(me.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===me.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return me.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new z(new me(e.slice()))}}function Wt(r,e,t){if(!t)throw new F(C.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Dr(r){if(!z.isDocumentKey(r))throw new F(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Cs(r){if(z.isDocumentKey(r))throw new F(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Ht(r){return"object"==typeof r&&null!==r&&(Object.getPrototypeOf(r)===Object.prototype||null===Object.getPrototypeOf(r))}function Jt(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":W(12329,{type:typeof r})}function _e(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new F(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Jt(r);throw new F(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function je(r,e){const t={typeString:r};return e&&(t.value=e),t}function Xt(r,e){if(!Ht(r))throw new F(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const i=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const o=r[n];if(i&&typeof o!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new F(C.INVALID_ARGUMENT,t);return!0}const xs=-62135596800;class de{static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new de(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<xs)throw new F(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:de._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Xt(e,de._jsonSchema))return new de(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-xs).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}de._jsonSchemaVersion="firestore/timestamp/1.0",de._jsonSchema={type:je("string",de._jsonSchemaVersion),seconds:je("number"),nanoseconds:je("number")};class ee{static fromTimestamp(e){return new ee(e)}static min(){return new ee(new de(0,0))}static max(){return new ee(new de(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const jt=-1;class _t{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new _t(ee.min(),z.empty(),jt)}static max(){return new _t(ee.max(),z.empty(),jt)}}function Mr(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=z.comparator(r.documentKey,e.documentKey),0!==t?t:se(r.largestBatchId,e.largestBatchId))}const Or="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ds{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Rt(r){return ln.apply(this,arguments)}function ln(){return(ln=(0,H.Z)(function*(r){if(r.code!==C.FAILED_PRECONDITION||r.message!==Or)throw r;B("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class P{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new P((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof P?t:P.resolve(t)}catch(t){return P.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):P.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):P.reject(t)}static resolve(e){return new P((t,n)=>{t(e)})}static reject(e){return new P((t,n)=>{n(e)})}static waitFor(e){return new P((t,n)=>{let i=0,s=0,o=!1;e.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&t()},c=>n(c))}),o=!0,s===i&&t()})}static or(e){let t=P.resolve(!1);for(const n of e)t=t.next(i=>i?P.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new P((n,i)=>{const s=e.length,o=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{o[h]=f,++u,u===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new P((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function oe(r){return"IndexedDbTransactionError"===r.name}let b=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>n.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}return r.ce=-1,r})();const R=-1;function M(r){return null==r}function K(r){return 0===r&&1/r==-1/0}const le="\x01";function It(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case le:t+="\x01\x11";break;default:t+=s}}return t}function ze(r){return r+le+"\x01"}const bi="mutationQueues",zt="mutations",Fr="documentMutations",Ri="remoteDocumentGlobal",Lr="targets",Br="targetDocuments",rr="targetGlobal",Si="collectionParents",Ur="clientMetadata",Fs="bundles",Ls="namedQueries";function ul(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function wn(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function ll(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class Oe{constructor(e,t){this.comparator=e,this.root=t||mt.EMPTY}insert(e,t){return new Oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(e){return new Oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,mt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Us(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Us(this.root,e,this.comparator,!1)}getReverseIterator(){return new Us(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Us(this.root,e,this.comparator,!0)}}class Us{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class mt{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??mt.RED,this.left=i??mt.EMPTY,this.right=s??mt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new mt(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return mt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return mt.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,mt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,mt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw W(27949);return e+(this.isRed()?0:1)}}mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1,mt.EMPTY=new class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new mt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Se{constructor(e){this.comparator=e,this.data=new Oe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hl(this.data.getIterator())}getIteratorFrom(e){return new hl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Se)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class hl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Dt{constructor(e){this.fields=e,e.sort(xe.comparator)}static empty(){return new Dt([])}unionWith(e){let t=new Se(xe.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Dt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qt(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class dl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Je{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new dl("Invalid base64 string: "+s):s}}(e);return new Je(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Je(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Je.EMPTY_BYTE_STRING=new Je("");const lp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hn(r){if(J(!!r,39018),"string"==typeof r){let e=0;const t=lp.exec(r);if(J(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:qe(r.seconds),nanos:qe(r.nanos)}}function qe(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function dn(r){return"string"==typeof r?Je.fromBase64String(r):Je.fromUint8Array(r)}const fl="server_timestamp",ml="__type__",pl="__previous_value__",gl="__local_write_time__";function qs(r){return(r?.mapValue?.fields||{})[ml]?.stringValue===fl}function Gs(r){const e=r.mapValue.fields[pl];return qs(e)?Gs(e):e}function Ci(r){const e=hn(r.mapValue.fields[gl].timestampValue);return new de(e.seconds,e.nanos)}class hp{constructor(e,t,n,i,s,o,u,c,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}}const xi="(default)";class ir{constructor(e,t){this.projectId=e,this.database=t||xi}static empty(){return new ir("","")}get isDefaultDatabase(){return this.database===xi}isEqual(e){return e instanceof ir&&e.projectId===this.projectId&&e.database===this.database}}const ca="__type__",_l="__max__",bn={mapValue:{fields:{__type__:{stringValue:_l}}}},la="__vector__",Gr="value";function Rn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?qs(r)?4:Al(r)?9007199254740991:Ks(r)?10:11:W(28295,{value:r})}function en(r,e){if(r===e)return!0;const t=Rn(r);if(t!==Rn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Ci(r).isEqual(Ci(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=hn(i.timestampValue),u=hn(s.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,dn(r.bytesValue).isEqual(dn(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return qe(i.geoPointValue.latitude)===qe(s.geoPointValue.latitude)&&qe(i.geoPointValue.longitude)===qe(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return qe(i.integerValue)===qe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=qe(i.doubleValue),u=qe(s.doubleValue);return o===u?K(o)===K(u):isNaN(o)&&isNaN(u)}return!1}(r,e);case 9:return Qt(r.arrayValue.values||[],e.arrayValue.values||[],en);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},u=s.mapValue.fields||{};if(ul(o)!==ul(u))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(void 0===u[c]||!en(o[c],u[c])))return!1;return!0}(r,e);default:return W(52216,{left:r})}var s}function Di(r,e){return void 0!==(r.values||[]).find(t=>en(t,e))}function Sn(r,e){if(r===e)return 0;const t=Rn(r),n=Rn(e);if(t!==n)return se(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(r.booleanValue,e.booleanValue);case 2:return function(s,o){const u=qe(s.integerValue||s.doubleValue),c=qe(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return yl(r.timestampValue,e.timestampValue);case 4:return yl(Ci(r),Ci(e));case 5:return Jn(r.stringValue,e.stringValue);case 6:return function(s,o){const u=dn(s),c=dn(o);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){const u=s.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=se(u[h],c[h]);if(0!==f)return f}return se(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){const u=se(qe(s.latitude),qe(o.latitude));return 0!==u?u:se(qe(s.longitude),qe(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Il(r.arrayValue,e.arrayValue);case 10:return function(s,o){const u=s.fields||{},c=o.fields||{},h=u[Gr]?.arrayValue,f=c[Gr]?.arrayValue,p=se(h?.values?.length||0,f?.values?.length||0);return 0!==p?p:Il(h,f)}(r.mapValue,e.mapValue);case 11:return function(s,o){if(s===bn.mapValue&&o===bn.mapValue)return 0;if(s===bn.mapValue)return 1;if(o===bn.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const I=Jn(c[p],f[p]);if(0!==I)return I;const x=Sn(u[c[p]],h[f[p]]);if(0!==x)return x}return se(c.length,f.length)}(r.mapValue,e.mapValue);default:throw W(23264,{he:t})}}function yl(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return se(r,e);const t=hn(r),n=hn(e),i=se(t.seconds,n.seconds);return 0!==i?i:se(t.nanos,n.nanos)}function Il(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Sn(t[i],n[i]);if(s)return s}return se(t.length,n.length)}function jr(r){return ha(r)}function ha(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=hn(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?dn(r.bytesValue).toBase64():"referenceValue"in r?z.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=ha(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of n)s?s=!1:i+=",",i+=`${o}:${ha(t.fields[o])}`;return i+"}"}(r.mapValue):W(61005,{value:r})}function zs(r){switch(Rn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Gs(r);return e?16+zs(e):16;case 5:return 2*r.stringValue.length;case 6:return dn(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(r.arrayValue.values||[]).reduce((i,s)=>i+zs(s),0);case 10:case 11:return function(n){let i=0;return wn(n.fields,(s,o)=>{i+=s.length+zs(o)}),i}(r.mapValue);default:throw W(13486,{value:r})}}function da(r){return!!r&&"integerValue"in r}function Ni(r){return!!r&&"arrayValue"in r}function $s(r){return!!r&&"mapValue"in r}function Ks(r){return(r?.mapValue?.fields||{})[ca]?.stringValue===la}function ki(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return wn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ki(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ki(r.arrayValue.values[t]);return e}return{...r}}function Al(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===_l}class pt{constructor(e){this.value=e}static empty(){return new pt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!$s(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ki(t)}setAll(e){let t=xe.emptyPath(),n={},i=[];e.forEach((o,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}o?n[u.lastSegment()]=ki(o):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());$s(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return en(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];$s(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){wn(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new pt(ki(this.value))}}function Rl(r){const e=[];return wn(r.fields,(t,n)=>{const i=new xe([t]);if($s(n)){const s=Rl(n.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Dt(e)}class Le{constructor(e,t,n,i,s,o,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(e){return new Le(e,0,ee.min(),ee.min(),ee.min(),pt.empty(),0)}static newFoundDocument(e,t,n,i){return new Le(e,1,t,ee.min(),n,i,0)}static newNoDocument(e,t){return new Le(e,2,t,ee.min(),ee.min(),pt.empty(),0)}static newUnknownDocument(e,t){return new Le(e,3,t,ee.min(),ee.min(),pt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ee.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Le&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Le(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Pn{constructor(e,t){this.position=e,this.inclusive=t}}function Sl(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],o=r.position[i];if(n=s.field.isKeyField()?z.comparator(z.fromName(o.referenceValue),t.key):Sn(o,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Pl(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!en(r.position[t],e.position[t]))return!1;return!0}class Mi{constructor(e,t="asc"){this.field=e,this.dir=t}}function mp(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class Vl{}class ye extends Vl{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new pp(e,t,n):"array-contains"===t?new yp(e,n):"in"===t?new Ml(e,n):"not-in"===t?new Ip(e,n):"array-contains-any"===t?new Tp(e,n):new ye(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new gp(e,n):new _p(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Sn(t,this.value)):null!==t&&Rn(this.value)===Rn(t)&&this.matchesComparison(Sn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pe extends Vl{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Pe(e,t)}matches(e){return zr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function zr(r){return"and"===r.op}function ma(r){return function Cl(r){for(const e of r.filters)if(e instanceof Pe)return!1;return!0}(r)&&zr(r)}function pa(r){if(r instanceof ye)return r.field.canonicalString()+r.op.toString()+jr(r.value);if(ma(r))return r.filters.map(e=>pa(e)).join(",");{const e=r.filters.map(t=>pa(t)).join(",");return`${r.op}(${e})`}}function xl(r,e){return r instanceof ye?(n=r,(i=e)instanceof ye&&n.op===i.op&&n.field.isEqual(i.field)&&en(n.value,i.value)):r instanceof Pe?function(n,i){return i instanceof Pe&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,o,u)=>s&&xl(o,i.filters[u]),!0)}(r,e):void W(19439);var n,i}function Nl(r){return r instanceof ye?`${(t=r).field.canonicalString()} ${t.op} ${jr(t.value)}`:r instanceof Pe?function(t){return t.op.toString()+" {"+t.getFilters().map(Nl).join(" ,")+"}"}(r):"Filter";var t}class pp extends ye{constructor(e,t,n){super(e,t,n),this.key=z.fromName(n.referenceValue)}matches(e){const t=z.comparator(e.key,this.key);return this.matchesComparison(t)}}class gp extends ye{constructor(e,t){super(e,"in",t),this.keys=kl(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class _p extends ye{constructor(e,t){super(e,"not-in",t),this.keys=kl(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function kl(r,e){return(e.arrayValue?.values||[]).map(t=>z.fromName(t.referenceValue))}class yp extends ye{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ni(t)&&Di(t.arrayValue,this.value)}}class Ml extends ye{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Di(this.value.arrayValue,t)}}class Ip extends ye{constructor(e,t){super(e,"not-in",t)}matches(e){if(Di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Di(this.value.arrayValue,t)}}class Tp extends ye{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ni(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Di(this.value.arrayValue,n))}}class Ep{constructor(e,t=null,n=[],i=[],s=null,o=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.Te=null}}function ga(r,e=null,t=[],n=[],i=null,s=null,o=null){return new Ep(r,e,t,n,i,s,o)}function or(r){const e=$(r);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>pa(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),M(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>jr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>jr(n)).join(",")),e.Te=t}return e.Te}function Oi(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!mp(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!xl(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Pl(r.startAt,e.startAt)&&Pl(r.endAt,e.endAt)}class fn{constructor(e,t=null,n=[],i=[],s=null,o="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null}}function Bl(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Kr(r){const e=$(r);if(null===e.Ie){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new Se(xe.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Mi(s,n))}),t.has(xe.keyField().canonicalString())||e.Ie.push(new Mi(xe.keyField(),n))}return e.Ie}function Tt(r){const e=$(r);return e.Ee||(e.Ee=function ql(r,e){if("F"===r.limitType)return ga(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Mi(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new Pn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Pn(r.startAt.position,r.startAt.inclusive):null;return ga(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,Kr(r))),e.Ee}function Hs(r,e,t){return new fn(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Fi(r,e){return Oi(Tt(r),Tt(e))&&r.limitType===e.limitType}function Gl(r){return`${or(Tt(r))}|lt:${r.limitType}`}function Qr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Nl(i)).join(", ")}]`),M(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>jr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>jr(i)).join(",")),`Target(${n})`}(Tt(r))}; limitType=${r.limitType})`}function Li(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):z.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Kr(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(o,u,c){const h=Sl(o,u,c);return o.inclusive?h<=0:h<0}(n.startAt,Kr(n),i)||n.endAt&&!function(o,u,c){const h=Sl(o,u,c);return o.inclusive?h>=0:h>0}(n.endAt,Kr(n),i)));var n,i}function Ap(r,e,t){const n=r.field.isKeyField()?z.comparator(e.key,t.key):function(s,o,u){const c=o.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Sn(c,h):W(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return W(19790,{direction:r.dir})}}class mn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){wn(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return ll(this.inner)}size(){return this.innerSize}}const vp=new Oe(z.comparator);function Nt(){return vp}const $l=new Oe(z.comparator);function Bi(...r){let e=$l;for(const t of r)e=e.insert(t.key,t);return e}function Kl(r){let e=$l;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function tn(){return Ui()}function Ql(){return Ui()}function Ui(){return new mn(r=>r.toString(),(r,e)=>r.isEqual(e))}const wp=new Oe(z.comparator),bp=new Se(z.comparator);function fe(...r){let e=bp;for(const t of r)e=e.add(t);return e}const Rp=new Se(se);function Ta(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:K(e)?"-0":e}}function Wl(r){return{integerValue:""+r}}function Hl(r,e){return function te(r){return"number"==typeof r&&Number.isInteger(r)&&!K(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?Wl(e):Ta(r,e)}class Js{constructor(){this._=void 0}}function Sp(r,e,t){return r instanceof Wr?function(i,s){const o={fields:{[ml]:{stringValue:fl},[gl]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&qs(s)&&(s=Gs(s)),s&&(o.fields[pl]=s),{mapValue:o}}(t,e):r instanceof ar?Xl(r,e):r instanceof ur?Yl(r,e):function(i,s){const o=Jl(i,s),u=Zl(o)+Zl(i.Ae);return da(o)&&da(i.Ae)?Wl(u):Ta(i.serializer,u)}(r,e)}function Pp(r,e,t){return r instanceof ar?Xl(r,e):r instanceof ur?Yl(r,e):t}function Jl(r,e){return r instanceof Hr?da(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Wr extends Js{}class ar extends Js{constructor(e){super(),this.elements=e}}function Xl(r,e){const t=eh(e);for(const n of r.elements)t.some(i=>en(i,n))||t.push(n);return{arrayValue:{values:t}}}class ur extends Js{constructor(e){super(),this.elements=e}}function Yl(r,e){let t=eh(e);for(const n of r.elements)t=t.filter(i=>!en(i,n));return{arrayValue:{values:t}}}class Hr extends Js{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Zl(r){return qe(r.integerValue||r.doubleValue)}function eh(r){return Ni(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Cp{constructor(e,t){this.version=e,this.transformResults=t}}class Ge{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ge}static exists(e){return new Ge(void 0,e)}static updateTime(e){return new Ge(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xs(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class Ys{}function th(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Xr(r.key,Ge.none()):new Jr(r.key,r.data,Ge.none());{const t=r.data,n=pt.empty();let i=new Se(xe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?n.delete(s):n.set(s,o),i=i.add(s)}return new pn(r.key,n,new Dt(i.toArray()),Ge.none())}}function xp(r,e,t){r instanceof Jr?function(i,s,o){const u=i.value.clone(),c=ih(i.fieldTransforms,s,o.transformResults);u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):r instanceof pn?function(i,s,o){if(!Xs(i.precondition,s))return void s.convertToUnknownDocument(o.version);const u=ih(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(rh(i)),c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Gi(r,e,t,n){return r instanceof Jr?function(s,o,u,c){if(!Xs(s.precondition,o))return u;const h=s.value.clone(),f=sh(s.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof pn?function(s,o,u,c){if(!Xs(s.precondition,o))return u;const h=sh(s.fieldTransforms,c,o),f=o.data;return f.setAll(rh(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,e,t,n):(u=t,Xs(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u);var o,u}function Dp(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Jl(n.transform,i||null);null!=s&&(null===t&&(t=pt.empty()),t.set(n.field,s))}return t||null}function nh(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Qt(n,i,(s,o)=>function Vp(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof ar&&i instanceof ar||n instanceof ur&&i instanceof ur?Qt(n.elements,i.elements,en):n instanceof Hr&&i instanceof Hr?en(n.Ae,i.Ae):n instanceof Wr&&i instanceof Wr);var n,i}(s,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Jr extends Ys{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pn extends Ys{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function rh(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function ih(r,e,t){const n=new Map;J(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let i=0;i<t.length;i++){const s=r[i],o=s.transform,u=e.data.field(s.field);n.set(s.field,Pp(o,u,t[i]))}return n}function sh(r,e,t){const n=new Map;for(const i of r){const s=i.transform,o=t.data.field(i.field);n.set(i.field,Sp(s,o,e))}return n}class Xr extends Ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ea extends Ys{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Aa{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&xp(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Gi(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Gi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ql();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let u=this.applyToLocalView(o,s.mutatedFields);u=t.has(i.key)?null:u;const c=th(o,u);null!==c&&n.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(ee.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),fe())}isEqual(e){return this.batchId===e.batchId&&Qt(this.mutations,e.mutations,(t,n)=>nh(t,n))&&Qt(this.baseMutations,e.baseMutations,(t,n)=>nh(t,n))}}class va{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){J(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=wp;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new va(e,t,n,i)}}class wa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}var it,Te;(Te=it||(it={}))[Te.OK=0]="OK",Te[Te.CANCELLED=1]="CANCELLED",Te[Te.UNKNOWN=2]="UNKNOWN",Te[Te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Te[Te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Te[Te.NOT_FOUND=5]="NOT_FOUND",Te[Te.ALREADY_EXISTS=6]="ALREADY_EXISTS",Te[Te.PERMISSION_DENIED=7]="PERMISSION_DENIED",Te[Te.UNAUTHENTICATED=16]="UNAUTHENTICATED",Te[Te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Te[Te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Te[Te.ABORTED=10]="ABORTED",Te[Te.OUT_OF_RANGE=11]="OUT_OF_RANGE",Te[Te.UNIMPLEMENTED=12]="UNIMPLEMENTED",Te[Te.INTERNAL=13]="INTERNAL",Te[Te.UNAVAILABLE=14]="UNAVAILABLE",Te[Te.DATA_LOSS=15]="DATA_LOSS",new ut([4294967295,4294967295],0);class ji extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Bp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Yr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function gh(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Up(r,e){return Yr(r,e.toTimestamp())}function et(r){return J(!!r,49232),ee.fromTimestamp(function(t){const n=hn(t);return new de(n.seconds,n.nanos)}(r))}function Pa(r,e){return Va(r,e).canonicalString()}function Va(r,e){const t=(i=r,new me(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function Ki(r,e){return Pa(r.databaseId,e.path)}function Ih(r){const e=function _h(r){const e=me.fromString(r);return J(function Sh(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}(e),10190,{key:e.toString()}),e}(r);return 4===e.length?me.emptyPath():function Th(r){return J(r.length>4&&"documents"===r.get(4),29091,{key:r.toString()}),r.popFirst(5)}(e)}function Eh(r,e,t){return{name:Ki(r,e),fields:t.value.mapValue.fields}}function wh(r){let e=Ih(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){J(1===n,65062);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){const I=bh(p);return I instanceof Pe&&ma(I)?I.getFilters():[I]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(I=>{return new Mi(Zr((L=I).field),function(U){switch(U){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction));var L}));let u=null;t.limit&&(u=function(p){let I;return I="object"==typeof p?p.value:p,M(I)?null:I}(t.limit));let c=null;var p;t.startAt&&(c=new Pn((p=t.startAt).values||[],!!p.before));let h=null;return t.endAt&&(h=function(p){return new Pn(p.values||[],!p.before)}(t.endAt)),function Ll(r,e,t,n,i,s,o,u){return new fn(r,e,t,n,i,s,o,u)}(e,i,o,s,u,"F",c,h)}function bh(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Zr(t.unaryFilter.field);return ye.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Zr(t.unaryFilter.field);return ye.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Zr(t.unaryFilter.field);return ye.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Zr(t.unaryFilter.field);return ye.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}}(r):void 0!==r.fieldFilter?ye.create(Zr((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return Pe.create(t.compositeFilter.filters.map(n=>bh(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return W(1026)}}(t.compositeFilter.op))}(r):W(30097,{filter:r});var t}function Zr(r){return xe.fromServerFormat(r.fieldPath)}function Wp(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}class Ph{constructor(e){this.yt=e}}function io(r){const e=wh({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Hs(e,e.limit,"L"):e}class dr{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(qe(e.integerValue));else if("doubleValue"in e){const n=qe(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),K(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=hn(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(dn(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Al(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Ks(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):W(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const i of Object.keys(n))this.Ot(i,t),this.Ct(n[i],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const i=Gr,s=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(qe(s)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const i of n)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),z.fromName(e).path.forEach(n=>{this.Ft(t,60),this.Ut(n,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}dr.Kt=new dr;class rg{constructor(){this.Cn=new Fa}addToCollectionParentIndex(e,t){return this.Cn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve(_t.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve(_t.min())}updateCollectionGroup(e,t,n){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}}class Fa{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new Se(me.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new Se(me.comparator)).toArray()}}new Uint8Array(0);const $h={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Et{static withCacheSize(e){return new Et(e,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Et.DEFAULT_COLLECTION_PERCENTILE=10,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Et.DEFAULT=new Et(41943040,Et.DEFAULT_COLLECTION_PERCENTILE,Et.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Et.DISABLED=new Et(-1,0,0);class mr{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new mr(0)}static cr(){return new mr(-1)}}const Xh="LruGarbageCollector";function Zh([r,e],[t,n]){const i=se(r,t);return 0===i?se(e,n):i}class og{constructor(e){this.Ir=e,this.buffer=new Se(Zh),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Zh(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ed{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){var t=this;B(Xh,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,H.Z)(function*(){t.Rr=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){oe(n)?B(Xh,"Ignoring IndexedDB error during garbage collection: ",n):yield Rt(n)}yield t.Vr(3e5)}))}}class ag{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return P.resolve(b.ce);const n=new og(t);return this.mr.forEachTarget(e,i=>n.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>n.Ar(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve($h)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$h):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,s,o,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),Gt()<=he.in.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-f}ms\n\tDetermined least recently used ${i} in `+(u-o)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${p} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}}class cg{constructor(){this.changes=new mn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?P.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class dg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class od{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Gi(n.mutation,i,Dt.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,fe()).next(()=>n))}getLocalViewOfDocuments(e,t,n=fe()){const i=tn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Bi();return s.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=tn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,fe()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,u)=>{t.set(o,u)})})}computeViews(e,t,n,i){let s=Nt();const o=Ui(),u=Ui();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof pn)?s=s.insert(h.key,h):void 0!==f?(o.set(h.key,f.mutation.getFieldMask()),Gi(f.mutation,h,f.mutation.getFieldMask(),de.now())):o.set(h.key,Dt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>u.set(h,new dg(f,o.get(h)??null))),u))}recalculateAndSaveOverlays(e,t){const n=Ui();let i=new Oe((o,u)=>o-u),s=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const u of o)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||Dt.empty();f=u.applyToLocalView(h,f),n.set(c,f);const p=(i.get(u.batchId)||fe()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{const o=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,p=Ql();f.forEach(I=>{if(!s.has(I)){const x=th(t.get(I),n.get(I));null!==x&&p.set(I,x),s=s.add(I)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,p))}return P.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return z.isDocumentKey((o=t).path)&&null===o.collectionGroup&&0===o.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function _a(r){return null!==r.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var o}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):P.resolve(tn());let u=jt,c=s;return o.next(h=>P.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?P.resolve():this.remoteDocumentCache.getEntry(e,f).next(I=>{c=c.insert(f,I)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,fe())).next(f=>({batchId:u,changes:Kl(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next(n=>{let i=Bi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let o=Bi();return this.indexManager.getCollectionParents(e,s).next(u=>P.forEach(u,c=>{const h=(p=t,I=c.child(s),new fn(I,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,I;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((p,I)=>{o=o.insert(p,I)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((c,h)=>{const f=h.getKey();null===o.get(f)&&(o=o.insert(f,Le.newInvalidDocument(f)))});let u=Bi();return o.forEach((c,h)=>{const f=s.get(c);void 0!==f&&Gi(f.mutation,h,Dt.empty(),de.now()),Li(t,h)&&(u=u.insert(c,h))}),u})}}class fg{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return P.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(i=t).id,version:i.version,createTime:et(i.createTime)}),P.resolve();var i}getNamedQuery(e,t){return P.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(i=t).name,query:io(i.bundledQuery),readTime:et(i.readTime)}),P.resolve();var i}}class mg{constructor(){this.overlays=new Oe(z.comparator),this.qr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tn();return P.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.St(e,t,s)}),P.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(n)),P.resolve()}getOverlaysForCollection(e,t,n){const i=tn(),s=t.length+1,o=new z(t.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Oe((h,f)=>h-f);const o=this.overlays.getIterator();for(;o.hasNext();){const h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=tn(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=tn(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return P.resolve(u)}St(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const o=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new wa(t,n));let s=this.qr.get(t);void 0===s&&(s=fe(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}}class pg{constructor(){this.sessionToken=Je.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}}class La{constructor(){this.Qr=new Se(ct.$r),this.Ur=new Se(ct.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new ct(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Gr(new ct(e,t))}zr(e,t){e.forEach(n=>this.removeReference(n,t))}jr(e){const t=new z(new me([])),n=new ct(t,e),i=new ct(t,e+1),s=[];return this.Ur.forEachInRange([n,i],o=>{this.Gr(o),s.push(o.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new z(new me([])),n=new ct(t,e),i=new ct(t,e+1);let s=fe();return this.Ur.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new ct(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ct{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return z.comparator(e.key,t.key)||se(e.Yr,t.Yr)}static Kr(e,t){return se(e.Yr,t.Yr)||z.comparator(e.key,t.key)}}class gg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Se(ct.$r)}checkEmpty(e){return P.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.tr;this.tr++;const o=new Aa(s,t,n,i);this.mutationQueue.push(o);for(const u of i)this.Zr=this.Zr.add(new ct(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(o)}lookupMutationBatch(e,t){return P.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ei(t+1),s=i<0?0:i;return P.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(0===this.mutationQueue.length?R:this.tr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ct(t,0),i=new ct(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],o=>{const u=this.Xr(o.Yr);s.push(u)}),P.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Se(se);return t.forEach(i=>{const s=new ct(i,0),o=new ct(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],u=>{n=n.add(u.Yr)})}),P.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;z.isDocumentKey(s)||(s=s.child(""));const o=new ct(new z(s),0);let u=new Se(se);return this.Zr.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Yr)),!0)},o),P.resolve(this.ti(u))}ti(e){const t=[];return e.forEach(n=>{const i=this.Xr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){J(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return P.forEach(t.mutations,i=>{const s=new ct(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new ct(t,0),i=this.Zr.firstAfterOrEqual(n);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return P.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class _g{constructor(e){this.ri=e,this.docs=new Oe(z.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return P.resolve(n?n.document.mutableCopy():Le.newInvalidDocument(t))}getEntries(e,t){let n=Nt();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Le.newInvalidDocument(i))}),P.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Nt();const o=t.path,u=new z(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Mr(new _t((r=f).readTime,r.key,jt),n)<=0||(i.has(f.key)||Li(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}var r;return P.resolve(s)}getAllFromCollectionGroup(e,t,n,i){W(9500)}ii(e,t){return P.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new yg(this)}getSize(e){return P.resolve(this.size)}}class yg extends cg{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),P.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class Ig{constructor(e){this.persistence=e,this.si=new mn(t=>or(t),Oi),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.oi=0,this._i=new La,this.targetCount=0,this.ai=mr.ur()}forEachTarget(e,t){return this.si.forEach((n,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),P.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new mr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.Pr(t),P.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.si.forEach((o,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(s).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return P.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),P.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),P.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),P.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return P.resolve(n)}containsKey(e,t){return P.resolve(this._i.containsKey(t))}}class Ba{constructor(e,t){this.ui={},this.overlays={},this.ci=new b(0),this.li=!1,this.li=!0,this.hi=new pg,this.referenceDelegate=e(this),this.Pi=new Ig(this),this.indexManager=new rg,this.remoteDocumentCache=new _g(n=>this.referenceDelegate.Ti(n)),this.serializer=new Ph(t),this.Ii=new fg(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new mg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new gg(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){B("MemoryPersistence","Starting transaction:",e);const i=new Tg(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ai(e,t){return P.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class Tg extends Ds{constructor(e){super(),this.currentSequenceNumber=e}}class fo{constructor(e){this.persistence=e,this.Ri=new La,this.Vi=null}static mi(e){return new fo(e)}get fi(){if(this.Vi)return this.Vi;throw W(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),P.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),P.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.fi.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.fi,n=>{const i=z.fromPath(n);return this.gi(e,i).next(s=>{s||t.removeEntry(i,ee.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return P.or([()=>P.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class mo{constructor(e,t){this.persistence=e,this.pi=new mn(n=>function ie(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=ze(e)),e=It(r.get(t),e);return ze(e)}(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=function td(r,e){return new ag(r,e)}(this,t)}static mi(e,t){return new mo(e,t)}Ei(){}di(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}wr(e){let t=0;return this.pr(e,n=>{t++}).next(()=>t)}pr(e,t){return P.forEach(this.pi,(n,i)=>this.br(e,n,i).next(s=>s?P.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,t).next(u=>{u||(n++,s.removeEntry(o,ee.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),P.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=zs(e.data.value)),t}br(e,t,n){return P.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const i=this.pi.get(t);return P.resolve(void 0!==i&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class $a{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=fe(),i=fe();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new $a(e,t.fromCache,n,i)}}class Ag{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class cd{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,ve.G6)()?8:function O(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}((0,ve.z$)())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ys(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ws(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Ag;return this.Ss(e,t,o).next(u=>{if(s.result=u,this.Vs)return this.bs(e,t,o,u.size)})}).next(()=>s.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(Gt()<=he.in.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",Qr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),P.resolve()):(Gt()<=he.in.DEBUG&&B("QueryEngine","Query:",Qr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(Gt()<=he.in.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",Qr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Tt(t))):P.resolve())}ys(e,t){if(Bl(t))return P.resolve(null);let n=Tt(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Hs(t,null,"F"),n=Tt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const o=fe(...s);return this.ps.getDocuments(e,o).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.Ds(t,u);return this.Cs(t,h,o,c.readTime)?this.ys(e,Hs(t,null,"F")):this.vs(e,h,t,c)}))})))}ws(e,t,n,i){return Bl(t)||i.isEqual(ee.min())?P.resolve(null):this.ps.getDocuments(e,n).next(s=>{const o=this.Ds(t,s);return this.Cs(t,o,n,i)?P.resolve(null):(Gt()<=he.in.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Qr(t)),this.vs(e,o,t,function er(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(1e9===n?new de(t+1,0):new de(t,n));return new _t(i,z.empty(),e)}(i,jt)).next(u=>u))})}Ds(e,t){let n=new Se(function zl(r){return(e,t)=>{let n=!1;for(const i of Kr(r)){const s=Ap(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}(e));return t.forEach((i,s)=>{Li(e,s)&&(n=n.add(s))}),n}Cs(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,n){return Gt()<=he.in.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",Qr(t)),this.ps.getDocumentsMatchingQuery(e,t,_t.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}const Ka="LocalStore";class wg{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new Oe(se),this.xs=new mn(s=>or(s),Oi),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new od(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function hd(r,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,H.Z)(function*(r,e){const t=$(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const o=[],u=[];let c=fe();for(const h of i){o.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({Ls:h,removedBatchIds:o,addedBatchIds:u}))})})})).apply(this,arguments)}function Sg(r,e){const t=$(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=R),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}class Za{constructor(){this.activeTargetIds=function Ia(){return Rp}()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ad{constructor(){this.Mo=new Za,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Za,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cg{Oo(e){}shutdown(){}}const vd="ConnectivityMonitor";class wd{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){B(vd,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){B(vd,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Io=null;function tu(){return null===Io?Io=268435456+Math.round(2147483648*Math.random()):Io++,"0x"+Io.toString(16)}const nu="RestConnection",xg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Dg{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===xi?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,s){const o=tu(),u=this.zo(e,t.toUriEncodedString());B(nu,`Sending RPC '${e}' ${o}:`,u,n);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,i,s);const{host:h}=new URL(u),f=(0,ve.Xx)(h);return this.Jo(e,u,c,n,f).then(p=>(B(nu,`Received RPC '${e}' ${o}: `,p),p),p=>{throw tt(nu,`RPC '${e}' ${o} failed with error: `,p,"url: ",u,"request:",n),p})}Ho(e,t,n,i,s,o){return this.Go(e,t,n,i,s)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+In,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}zo(e,t){return`${this.Uo}/v1/${t}:${xg[e]}`}terminate(){}}class Ng{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const At="WebChannelConnection";class kg extends Dg{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,s){const o=tu();return new Promise((u,c)=>{const h=new re;h.setWithCredentials(!0),h.listenOnce(Ut.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Me.NO_ERROR:const p=h.getResponseJson();B(At,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),u(p);break;case Me.TIMEOUT:B(At,`RPC '${e}' ${o} timed out`),c(new F(C.DEADLINE_EXCEEDED,"Request time out"));break;case Me.HTTP_ERROR:const I=h.getStatus();if(B(At,`RPC '${e}' ${o} failed with status:`,I,"response text:",h.getResponseText()),I>0){let x=h.getResponseJson();Array.isArray(x)&&(x=x[0]);const L=x?.error;if(L&&L.status&&L.message){const G=function(X){const ce=X.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(ce)>=0?ce:C.UNKNOWN}(L.status);c(new F(G,L.message))}else c(new F(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new F(C.UNAVAILABLE,"Connection failed."));break;default:W(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{B(At,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(i);B(At,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,n,15)})}T_(e,t,n){const i=tu(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=dt(),u=Ze(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");B(At,`Creating RPC '${e}' stream ${i}: ${f}`,c);const p=o.createWebChannel(f,c);this.I_(p);let I=!1,x=!1;const L=new Ng({Yo:U=>{x?B(At,`Not sending because RPC '${e}' stream ${i} is closed:`,U):(I||(B(At,`Opening RPC '${e}' stream ${i} transport.`),p.open(),I=!0),B(At,`RPC '${e}' stream ${i} sending:`,U),p.send(U))},Zo:()=>p.close()}),G=(U,X,ce)=>{U.listen(X,ne=>{try{ce(ne)}catch(Ie){setTimeout(()=>{throw Ie},0)}})};return G(p,Ve.EventType.OPEN,()=>{x||(B(At,`RPC '${e}' stream ${i} transport opened.`),L.o_())}),G(p,Ve.EventType.CLOSE,()=>{x||(x=!0,B(At,`RPC '${e}' stream ${i} transport closed`),L.a_(),this.E_(p))}),G(p,Ve.EventType.ERROR,U=>{x||(x=!0,tt(At,`RPC '${e}' stream ${i} transport errored. Name:`,U.name,"Message:",U.message),L.a_(new F(C.UNAVAILABLE,"The operation could not be completed")))}),G(p,Ve.EventType.MESSAGE,U=>{if(!x){const X=U.data[0];J(!!X,16349);const ce=X,ne=ce?.error||ce[0]?.error;if(ne){B(At,`RPC '${e}' stream ${i} received error:`,ne);const Ie=ne.status;let Ee=function(y){const E=it[y];if(void 0!==E)return function uh(r){if(void 0===r)return Fe("GRPC error has no .code"),C.UNKNOWN;switch(r){case it.OK:return C.OK;case it.CANCELLED:return C.CANCELLED;case it.UNKNOWN:return C.UNKNOWN;case it.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case it.INTERNAL:return C.INTERNAL;case it.UNAVAILABLE:return C.UNAVAILABLE;case it.UNAUTHENTICATED:return C.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case it.NOT_FOUND:return C.NOT_FOUND;case it.ALREADY_EXISTS:return C.ALREADY_EXISTS;case it.PERMISSION_DENIED:return C.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case it.ABORTED:return C.ABORTED;case it.OUT_OF_RANGE:return C.OUT_OF_RANGE;case it.UNIMPLEMENTED:return C.UNIMPLEMENTED;case it.DATA_LOSS:return C.DATA_LOSS;default:return W(39323,{code:r})}}(E)}(Ie),Ae=ne.message;void 0===Ee&&(Ee=C.INTERNAL,Ae="Unknown error status: "+Ie+" with message "+ne.message),x=!0,L.a_(new F(Ee,Ae)),p.close()}else B(At,`RPC '${e}' stream ${i} received:`,X),L.u_(X)}}),G(u,we.STAT_EVENT,U=>{U.stat===ue.PROXY?B(At,`RPC '${e}' stream ${i} detected buffering proxy`):U.stat===ue.NOPROXY&&B(At,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.__()},0),L}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function To(){return typeof document<"u"?document:null}function gr(r){return new Bp(r,!0)}class ru{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&B("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Rd="PersistentStream";class Mg{constructor(e,t,n,i,s,o,u,c){this.Mi=e,this.S_=n,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ru(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){var e=this;return(0,H.Z)(function*(){e.x_()&&(yield e.close(0))})()}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){var e=this;return(0,H.Z)(function*(){if(e.O_())return e.close(0)})()}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){var n=this;return(0,H.Z)(function*(){n.Q_(),n.U_(),n.M_.cancel(),n.D_++,4!==e?n.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(Fe(t.toString()),Fe("Using maximum backoff delay to prevent overloading the backend."),n.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.K_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.r_(t)})()}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.D_===t&&this.G_(n,i)},n=>{e(()=>{const i=new F(C.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{n(()=>this.z_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.F_?this.J_(i):this.onNext(i))})}N_(){var e=this;this.state=5,this.M_.p_((0,H.Z)(function*(){e.state=0,e.start()}))}z_(e){return B(Rd,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(B(Rd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Fg extends Mg{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return J(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,J(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){J(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function jp(r,e){return r&&r.length>0?(J(void 0!==e,14353),r.map(t=>function(i,s){let o=et(i.updateTime?i.updateTime:s);return o.isEqual(ee.min())&&(o=et(s)),new Cp(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=et(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=function Ca(r){return new me(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Qi(r,e){let t;if(e instanceof Jr)t={update:Eh(r,e.key,e.value)};else if(e instanceof Xr)t={delete:Ki(r,e.key)};else if(e instanceof pn)t={update:Eh(r,e.key,e.data),updateMask:Wp(e.fieldMask)};else{if(!(e instanceof Ea))return W(16599,{Vt:e.type});t={verify:Ki(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){const u=o.transform;if(u instanceof Wr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ar)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ur)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Hr)return{fieldPath:o.field.canonicalString(),increment:u.Ae};throw W(20930,{transform:o.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:Up(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:W(27497)),t;var s}(this.serializer,n))};this.q_(t)}}class Lg{}class Bg extends Lg{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new F(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Go(e,Va(t,n),i,s,o)).catch(s=>{throw"FirebaseError"===s.name?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new F(C.UNKNOWN,s.toString())})}Ho(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Ho(e,Va(t,n),i,o,u,s)).catch(o=>{throw"FirebaseError"===o.name?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new F(C.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Ug{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Fe(t),this.aa=!1):B("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const _r="RemoteStore";class qg{constructor(e,t,n,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(u=>{n.enqueueAndForget((0,H.Z)(function*(){var c;kn(o)&&(B(_r,"Restarting streams for network reachability change."),yield(c=(0,H.Z)(function*(f){const p=$(f);p.Ea.add(4),yield ai(p),p.Ra.set("Unknown"),p.Ea.delete(4),yield ts(p)}),function h(f){return c.apply(this,arguments)})(o))}))}),this.Ra=new Ug(n,i)}}function ts(r){return iu.apply(this,arguments)}function iu(){return(iu=(0,H.Z)(function*(r){if(kn(r))for(const e of r.da)yield e(!0)})).apply(this,arguments)}function ai(r){return su.apply(this,arguments)}function su(){return(su=(0,H.Z)(function*(r){for(const e of r.da)yield e(!1)})).apply(this,arguments)}function kn(r){return 0===$(r).Ea.size}function Ao(r,e,t){return fu.apply(this,arguments)}function fu(){return(fu=(0,H.Z)(function*(r,e,t){if(!oe(e))throw e;r.Ea.add(1),yield ai(r),r.Ra.set("Offline"),t||(t=()=>function dd(r){const e=$(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}(r.localStore)),r.asyncQueue.enqueueRetryable((0,H.Z)(function*(){B(_r,"Retrying IndexedDB access"),yield t(),r.Ea.delete(1),yield ts(r)}))})).apply(this,arguments)}function Vd(r,e){return e().catch(t=>Ao(r,t,e))}function ci(r){return mu.apply(this,arguments)}function mu(){return(mu=(0,H.Z)(function*(r){const e=$(r),t=Mn(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:R;for(;Kg(e);)try{const i=yield Sg(e.localStore,n);if(null===i){0===e.Ta.length&&t.L_();break}n=i.batchId,Qg(e,i)}catch(i){yield Ao(e,i)}Cd(e)&&xd(e)})).apply(this,arguments)}function Kg(r){return kn(r)&&r.Ta.length<10}function Qg(r,e){r.Ta.push(e);const t=Mn(r);t.O_()&&t.X_&&t.ea(e.mutations)}function Cd(r){return kn(r)&&!Mn(r).x_()&&r.Ta.length>0}function xd(r){Mn(r).start()}function Wg(r){return pu.apply(this,arguments)}function pu(){return(pu=(0,H.Z)(function*(r){Mn(r).ra()})).apply(this,arguments)}function Hg(r){return gu.apply(this,arguments)}function gu(){return(gu=(0,H.Z)(function*(r){const e=Mn(r);for(const t of r.Ta)e.ea(t.mutations)})).apply(this,arguments)}function Jg(r,e,t){return _u.apply(this,arguments)}function _u(){return(_u=(0,H.Z)(function*(r,e,t){const n=r.Ta.shift(),i=va.from(n,e,t);yield Vd(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield ci(r)})).apply(this,arguments)}function Xg(r,e){return yu.apply(this,arguments)}function yu(){return yu=(0,H.Z)(function*(r,e){var t;e&&Mn(r).X_&&(yield(t=(0,H.Z)(function*(i,s){if(function ah(r){switch(r){case C.OK:return W(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return W(15467,{code:r})}}(u=s.code)&&u!==C.ABORTED){const o=i.Ta.shift();Mn(i).B_(),yield Vd(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield ci(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),Cd(r)&&xd(r)}),yu.apply(this,arguments)}function Dd(r,e){return Iu.apply(this,arguments)}function Iu(){return(Iu=(0,H.Z)(function*(r,e){const t=$(r);t.asyncQueue.verifyOperationInProgress(),B(_r,"RemoteStore received new credentials");const n=kn(t);t.Ea.add(3),yield ai(t),n&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield ts(t)})).apply(this,arguments)}function Tu(r,e){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,H.Z)(function*(r,e){const t=$(r);e?(t.Ea.delete(2),yield ts(t)):e||(t.Ea.add(2),yield ai(t),t.Ra.set("Unknown"))})).apply(this,arguments)}function Mn(r){return r.fa||(r.fa=function(t,n,i){const s=$(t);return s.sa(),new Fg(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:Wg.bind(null,r),r_:Xg.bind(null,r),ta:Hg.bind(null,r),na:Jg.bind(null,r)}),r.da.push(function(){var e=(0,H.Z)(function*(t){t?(r.fa.B_(),yield ci(r)):(yield r.fa.stop(),r.Ta.length>0&&(B(_r,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))});return function(t){return e.apply(this,arguments)}}())),r.fa}class Au{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new He,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const o=Date.now()+n,u=new Au(e,t,o,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new F(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hi(r,e){if(Fe("AsyncQueue",`${e}: ${r}`),oe(r))return new F(C.UNAVAILABLE,`${e}: ${r}`);throw r}class Zg{constructor(){this.queries=kd(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,n){const i=$(t),s=i.queries;i.queries=kd(),s.forEach((o,u)=>{for(const c of u.Sa)c.onError(n)})}(this,new F(C.ABORTED,"Firestore shutting down"))}}function kd(){return new mn(r=>Gl(r),Fi)}var Pu,Md;(Md=Pu||(Pu={})).Ma="default",Md.Cache="cache";const On="SyncEngine";class i_{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new mn(u=>Gl(u),Fi),this.Iu=new Map,this.Eu=new Set,this.du=new Oe(z.comparator),this.Au=new Map,this.Ru=new La,this.Vu={},this.mu=new Map,this.fu=mr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function Lu(){return(Lu=(0,H.Z)(function*(r,e,t){const n=function rc(r){const e=$(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=h_.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=d_.bind(null,e),e}(r);try{const i=yield function(o,u){const c=$(o),h=de.now(),f=u.reduce((x,L)=>x.add(L.key),fe());let p,I;return c.persistence.runTransaction("Locally write mutations","readwrite",x=>{let L=Nt(),G=fe();return c.Ns.getEntries(x,f).next(U=>{L=U,L.forEach((X,ce)=>{ce.isValidDocument()||(G=G.add(X))})}).next(()=>c.localDocuments.getOverlayedDocuments(x,L)).next(U=>{p=U;const X=[];for(const ce of u){const ne=Dp(ce,p.get(ce.key).overlayedDocument);null!=ne&&X.push(new pn(ce.key,ne,Rl(ne.value.mapValue),Ge.exists(!0)))}return c.mutationQueue.addMutationBatch(x,h,X,u)}).next(U=>{I=U;const X=U.applyToLocalDocumentSet(p,G);return c.documentOverlayCache.saveOverlays(x,U.batchId,X)})}).then(()=>({batchId:I.batchId,changes:Kl(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,u,c){let h=o.Vu[o.currentUser.toKey()];h||(h=new Oe(se)),h=h.insert(u,c),o.Vu[o.currentUser.toKey()]=h}(n,i.batchId,t),yield _n(n,i.changes),yield ci(n.remoteStore)}catch(i){const s=hi(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function zd(r,e,t){const n=$(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Tu.forEach((s,o)=>{const u=o.view.va(e);u.snapshot&&i.push(u.snapshot)}),function(o,u){const c=$(o);c.onlineState=u;let h=!1;c.queries.forEach((f,p)=>{for(const I of p.Sa)I.va(u)&&(h=!0)}),h&&function Su(r){r.Ca.forEach(e=>{e.next()})}(c)}(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function h_(r,e){return qu.apply(this,arguments)}function qu(){return(qu=(0,H.Z)(function*(r,e){const t=$(r),n=e.batch.batchId;try{const i=yield function bg(r,e){const t=$(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const p=h.batch,I=p.keys();let x=P.resolve();return I.forEach(L=>{x=x.next(()=>f.getEntry(c,L)).next(G=>{const U=h.docVersions.get(L);J(null!==U,48541),G.version.compareTo(U)<0&&(p.applyToRemoteDocument(G,h),G.isValidDocument()&&(G.setReadTime(h.commitVersion),f.addEntry(G)))})}),x.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=fe();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);$u(t,n,null),zu(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield _n(t,i)}catch(i){yield Rt(i)}})).apply(this,arguments)}function d_(r,e,t){return Gu.apply(this,arguments)}function Gu(){return(Gu=(0,H.Z)(function*(r,e,t){const n=$(r);try{const i=yield function(o,u){const c=$(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(p=>(J(null!==p,37113),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);$u(n,e,t),zu(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield _n(n,i)}catch(i){yield Rt(i)}})).apply(this,arguments)}function zu(r,e){(r.mu.get(e)||[]).forEach(t=>{t.resolve()}),r.mu.delete(e)}function $u(r,e,t){const n=$(r);let i=n.Vu[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function _n(r,e,t){return Wu.apply(this,arguments)}function Wu(){return Wu=(0,H.Z)(function*(r,e,t){const n=$(r),i=[],s=[],o=[];var u;n.Tu.isEmpty()||(n.Tu.forEach((u,c)=>{o.push(n.pu(c,e,t).then(h=>{if((h||t)&&n.isPrimaryClient){const f=h?!h.fromCache:t?.targetChanges.get(c.targetId)?.current;n.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(h){i.push(h);const f=$a.As(c.targetId,h);s.push(f)}}))}),yield Promise.all(o),n.Pu.H_(i),yield(u=(0,H.Z)(function*(h,f){const p=$(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>P.forEach(f,x=>P.forEach(x.Es,L=>p.persistence.referenceDelegate.addReference(I,x.targetId,L)).next(()=>P.forEach(x.ds,L=>p.persistence.referenceDelegate.removeReference(I,x.targetId,L)))))}catch(I){if(!oe(I))throw I;B(Ka,"Failed to update sequence numbers: "+I)}for(const I of f){const x=I.targetId;if(!I.fromCache){const L=p.Ms.get(x),U=L.withLastLimboFreeSnapshotVersion(L.snapshotVersion);p.Ms=p.Ms.insert(x,U)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),Wu.apply(this,arguments)}function p_(r,e){return Hu.apply(this,arguments)}function Hu(){return(Hu=(0,H.Z)(function*(r,e){const t=$(r);if(!t.currentUser.isEqual(e)){B(On,"User change. New user:",e.toKey());const n=yield hd(t.localStore,e);t.currentUser=e,(s=t).mu.forEach(u=>{u.forEach(c=>{c.reject(new F(C.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.mu.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield _n(t,n.Ls)}var s})).apply(this,arguments)}let ic=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,H.Z)(function*(){n.serializer=gr(t.databaseInfo.databaseId),n.sharedClientState=n.Du(t),n.persistence=n.Cu(t),yield n.persistence.start(),n.localStore=n.vu(t),n.gcScheduler=n.Fu(t,n.localStore),n.indexBackfillerScheduler=n.Mu(t,n.localStore)})()}Fu(t,n){return null}Mu(t,n){return null}vu(t){return function ld(r,e,t,n){return new wg(r,e,t,n)}(this.persistence,new cd,t.initialUser,this.serializer)}Cu(t){return new Ba(fo.mi,this.serializer)}Du(t){return new Ad}terminate(){var t=this;return(0,H.Z)(function*(){t.gcScheduler?.stop(),t.indexBackfillerScheduler?.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class sc extends ic{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return J(this.persistence.referenceDelegate instanceof mo,46915),new ed(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Et.withCacheSize(this.cacheSizeBytes):Et.DEFAULT;return new Ba(n=>mo.mi(n,t),this.serializer)}}let fi=(()=>{class r{initialize(t,n){var i=this;return(0,H.Z)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>zd(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=p_.bind(null,i.syncEngine),yield Tu(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new Zg}createDatastore(t){const n=gr(t.databaseInfo.databaseId),i=new kg(t.databaseInfo);return new Bg(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,s=this.datastore,o=t.asyncQueue,u=n=>zd(this.syncEngine,n,0),c=wd.v()?new wd:new Cg,new qg(i,s,o,u,c);var i,s,o,u,c}createSyncEngine(t,n){return function(s,o,u,c,h,f,p){const I=new i_(s,o,u,c,h,f);return p&&(I.gu=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,H.Z)(function*(){var n;yield(n=(0,H.Z)(function*(s){const o=$(s);B(_r,"RemoteStore shutting down."),o.Ea.add(5),yield ai(o),o.Aa.shutdown(),o.Ra.set("Unknown")}),function i(s){return n.apply(this,arguments)})(t.remoteStore),t.datastore?.terminate(),t.eventManager?.terminate()})()}}return r.provider={build:()=>new r},r})();const Fn="FirestoreClient";class V_{constructor(e,t,n,i,s){var o=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=We.UNAUTHENTICATED,this.clientId=Hn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var u=(0,H.Z)(function*(c){B(Fn,"Received user=",c.uid),yield o.authCredentialListener(c),o.user=c});return function(c){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(B(Fn,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new He;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,H.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=hi(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function oc(r,e){return ac.apply(this,arguments)}function ac(){return ac=(0,H.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),B(Fn,"Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,H.Z)(function*(s){n.isEqual(s)||(yield hd(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),ac.apply(this,arguments)}function Xd(r,e){return uc.apply(this,arguments)}function uc(){return(uc=(0,H.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function cc(r){return lc.apply(this,arguments)}(r);B(Fn,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Dd(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Dd(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function lc(){return(lc=(0,H.Z)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){B(Fn,"Using user provided OfflineComponentProvider");try{yield oc(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;tt("Error using user provided cache. Falling back to memory cache: "+e),yield oc(r,new ic)}}else B(Fn,"Using default OfflineComponentProvider"),yield oc(r,new sc(void 0));var i;return r._offlineComponents})).apply(this,arguments)}function hc(){return(hc=(0,H.Z)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(B(Fn,"Using user provided OnlineComponentProvider"),yield Xd(r,r._uninitializedComponentsProvider._online)):(B(Fn,"Using default OnlineComponentProvider"),yield Xd(r,new fi))),r._onlineComponents})).apply(this,arguments)}function dc(r){return function bo(r){return hc.apply(this,arguments)}(r).then(e=>e.syncEngine)}function sf(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const of=new Map,af="firestore.googleapis.com";class cf{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new F(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=af,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new F(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function An(r,e,t,n){if(!0===e&&!0===n)throw new F(C.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=sf(e.experimentalLongPollingOptions??{}),function(n){if(void 0!==n.timeoutSeconds){if(isNaN(n.timeoutSeconds))throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new F(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ns{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new cf({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new F(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new F(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new cf(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new bs;switch(n.type){case"firstParty":return new Vs(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new F(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,H.Z)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=of.get(t);n&&(B("ComponentProvider","Removing Datastore"),of.delete(t),n.terminate())}(this),Promise.resolve()}}class lt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lt(this.firestore,e,this._query)}}class Ce{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ce(this.firestore,e,this._key)}toJSON(){return{type:Ce._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Xt(t,Ce._jsonSchema))return new Ce(e,n||null,new z(me.fromString(t.referencePath)))}}Ce._jsonSchemaVersion="firestore/documentReference/1.0",Ce._jsonSchema={type:je("string",Ce._jsonSchemaVersion),referencePath:je("string")};class sn extends lt{constructor(e,t,n){super(e,t,function $r(r){return new fn(r)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ce(this.firestore,null,new z(e))}withConverter(e){return new sn(this.firestore,e,this._path)}}function G_(r,e,...t){if(r=(0,ve.m9)(r),Wt("collection","path",e),r instanceof ns){const n=me.fromString(e,...t);return Cs(n),new sn(r,null,n)}{if(!(r instanceof Ce||r instanceof sn))throw new F(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(me.fromString(e,...t));return Cs(n),new sn(r.firestore,null,n)}}const hf="AsyncQueue";class df{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ru(this,"async_queue_retry"),this._c=()=>{const n=To();n&&B(hf,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=To();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=To();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new He;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){var e=this;return(0,H.Z)(function*(){if(0!==e.Xu.length){try{yield e.Xu[0](),e.Xu.shift(),e.M_.reset()}catch(t){if(!oe(t))throw t;B(hf,"Operation failed with retryable error: "+t)}e.Xu.length>0&&e.M_.p_(()=>e.lc())}})()}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,Fe("INTERNAL UNHANDLED ERROR: ",ff(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Au.createAndSchedule(this,e,t,n,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&W(47125,{Pc:ff(this.nc)})}verifyOperationInProgress(){}Tc(){var e=this;return(0,H.Z)(function*(){let t;do{t=e.ac,yield t}while(t!==e.ac)})()}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ff(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+"\n"+r.stack),e}class Ne extends ns{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new df,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){var e=this;return(0,H.Z)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new df(t),e._firestoreClient=void 0,yield t}})()}}function $_(r,e){const t="object"==typeof r?r:(0,Y.Mq)(),n="string"==typeof r?r:e||xi,i=(0,Y.qX)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=(0,ve.P0)("firestore");s&&function q_(r,e,t,n={}){r=_e(r,ns);const i=(0,ve.Xx)(e),s=r._getSettings(),o={...s,emulatorOptions:r._getEmulatorOptions()},u=`${e}:${t}`;i&&((0,ve.Uo)(`https://${u}`),(0,ve.dp)("Firestore",!0)),s.host!==af&&s.host!==u&&tt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...s,host:u,ssl:i,emulatorOptions:n};if(!(0,ve.vZ)(c,o)&&(r._setSettings(c),n.mockUserToken)){let h,f;if("string"==typeof n.mockUserToken)h=n.mockUserToken,f=We.MOCK_USER;else{h=(0,ve.Sg)(n.mockUserToken,r._app?.options.projectId);const p=n.mockUserToken.sub||n.mockUserToken.user_id;if(!p)throw new F(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new We(p)}r._authCredentials=new Rs(new Ei(h,f))}}(i,...s)}return i}function $e(r){if(r._terminated)throw new F(C.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||function mf(r){const e=r._freezeSettings(),t=new hp(r._databaseId,r._app?.options.appId||"",r._persistenceKey,(u=e).host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,sf(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator);var u;r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new V_(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&function(i){const s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}}(r._componentsProvider))}(r),r._firestoreClient}class Ot{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ot(Je.fromBase64String(e))}catch(t){throw new F(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ot(Je.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ot._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Xt(e,Ot._jsonSchema))return Ot.fromBase64String(e.bytes)}}Ot._jsonSchemaVersion="firestore/bytes/1.0",Ot._jsonSchema={type:je("string",Ot._jsonSchemaVersion),bytes:je("string")};class Tr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new F(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class _f{constructor(e){this._methodName=e}}class on{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:on._jsonSchemaVersion}}static fromJSON(e){if(Xt(e,on._jsonSchema))return new on(e.latitude,e.longitude)}}on._jsonSchemaVersion="firestore/geoPoint/1.0",on._jsonSchema={type:je("string",on._jsonSchemaVersion),latitude:je("number"),longitude:je("number")};class $t{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:$t._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Xt(e,$t._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>"number"==typeof t))return new $t(e.vectorValues);throw new F(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$t._jsonSchemaVersion="firestore/vectorValue/1.0",$t._jsonSchema={type:je("string",$t._jsonSchemaVersion),vectorValues:je("object")};const W_=/^__.*__$/;class H_{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new pn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Jr(e,this.data,t,this.fieldTransforms)}}function If(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{Ac:r})}}class Ro{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Ro({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Vo(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(If(this.Ac)&&W_.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class J_{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||gr(e)}Cc(e,t,n,i=!1){return new Ro({Ac:e,methodName:t,Dc:n,path:xe.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Er(r){const e=r._freezeSettings(),t=gr(r._databaseId);return new J_(r._databaseId,!!e.ignoreUndefinedProperties,t)}function So(r,e,t,n,i,s={}){const o=r.Cc(s.merge||s.mergeFields?2:0,e,t,i);Ec("Data must be an object, but it was:",o,n);const u=Af(n,o);let c,h;if(s.merge)c=new Dt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){const f=[];for(const p of s.mergeFields){const I=ss(e,p,t);if(!o.contains(I))throw new F(C.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);wf(f,I)||f.push(I)}c=new Dt(f),h=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=o.fieldTransforms;return new H_(new pt(u),c,h)}function Ar(r,e){if(vf(r=(0,ve.m9)(r)))return Ec("Unsupported field value:",e,r),Af(r,e);if(r instanceof _f)return function(n,i){if(!If(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(n,i){const s=[];let o=0;for(const u of n){let c=Ar(u,i.wc(o));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,ve.m9)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Hl(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=de.fromDate(n);return{timestampValue:Yr(i.serializer,s)}}if(n instanceof de){const s=new de(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Yr(i.serializer,s)}}if(n instanceof on)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ot)return{bytesValue:gh(i.serializer,n._byteString)};if(n instanceof Ce){const s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Pa(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof $t)return u=i,{mapValue:{fields:{[ca]:{stringValue:la},[Gr]:{arrayValue:{values:n.toArray().map(h=>{if("number"!=typeof h)throw u.Sc("VectorValues must only contain numeric values.");return Ta(u.serializer,h)})}}}}};var u;throw i.Sc(`Unsupported field value: ${Jt(n)}`)}(r,e)}function Af(r,e){const t={};return ll(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wn(r,(n,i)=>{const s=Ar(i,e.mc(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function vf(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof de||r instanceof on||r instanceof Ot||r instanceof Ce||r instanceof _f||r instanceof $t)}function Ec(r,e,t){if(!vf(t)||!Ht(t)){const n=Jt(t);throw e.Sc("an object"===n?r+" a custom object":r+" "+n)}}function ss(r,e,t){if((e=(0,ve.m9)(e))instanceof Tr)return e._internalPath;if("string"==typeof e)return Po(r,e);throw Vo("Field path arguments must be of type string or ",r,!1,void 0,t)}const X_=new RegExp("[~\\*/\\[\\]]");function Po(r,e,t){if(e.search(X_)>=0)throw Vo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Tr(...e.split("."))._internalPath}catch{throw Vo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Vo(r,e,t,n,i){const s=n&&!n.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${n}`),o&&(c+=` in document ${i}`),c+=")"),new F(C.INVALID_ARGUMENT,u+r+c)}function wf(r,e){return r.some(t=>t.isEqual(e))}class os{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ce(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Y_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Co("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Y_ extends os{data(){return super.data()}}function Co(r,e){return"string"==typeof e?Po(r,e):e instanceof Tr?e._internalPath:e._delegate._internalPath}class Ln{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ft extends os{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Mo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Co("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new F(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ft._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle="NOT SUPPORTED",t):t}}Ft._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ft._jsonSchema={type:je("string",Ft._jsonSchemaVersion),bundleSource:je("string","DocumentSnapshot"),bundleName:je("string"),bundle:je("string")};class Mo extends Ft{data(e={}){return super.data(e)}}class Lt{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ln(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Mo(this._firestore,this._userDataWriter,n.key,n,new Ln(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Mo(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:o++}))}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new Mo(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Ln(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),1!==u.type&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:ty(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new F(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Lt._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Hn.newId();const t=[],n=[],i=[];return this.docs.forEach(s=>{null!==s._document&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle="NOT SUPPORTED",e}}function ty(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:r})}}function ny(r,e){const t=_e(r.firestore,Ne),n=function j_(r,e,...t){if(r=(0,ve.m9)(r),1===arguments.length&&(e=Hn.newId()),Wt("doc","path",e),r instanceof ns){const n=me.fromString(e,...t);return Dr(n),new Ce(r,null,new z(n))}{if(!(r instanceof Ce||r instanceof sn))throw new F(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(me.fromString(e,...t));return Dr(n),new Ce(r.firestore,r instanceof sn?r.converter:null,new z(n))}}(r),i=function ko(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e);return function us(r,e){return function(n,i){const s=new He;return n.asyncQueue.enqueueAndForget((0,H.Z)(function*(){return function c_(r,e,t){return Lu.apply(this,arguments)}(yield dc(n),i,s)})),s.promise}($e(r),e)}(t,[So(Er(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,Ge.exists(!1))]).then(()=>n)}Lt._jsonSchemaVersion="firestore/querySnapshot/1.0",Lt._jsonSchema={type:je("string",Lt._jsonSchemaVersion),bundleSource:je("string","QuerySnapshot"),bundleName:je("string"),bundle:je("string")},function(e,t=!0){In=Y.Jn,(0,Y.Xd)(new Ke.wA("firestore",(n,{instanceIdentifier:i,options:s})=>{const o=n.getProvider("app").getImmediate(),u=new Ne(new Ss(n.getProvider("auth-internal")),new Ai(o,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new F(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ir(h.options.projectId,f)}(o,i),o);return s={useFetchStreams:t,...s},u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,Y.KN)(gt,"4.9.2",e),(0,Y.KN)(gt,"4.9.2","esm2020")}()},5861:(Wn,wt,be)=>{function H(Ke,he,ve,Ye,st,ut,Qe){try{var j=Ke[ut](Qe),q=j.value}catch(re){return void ve(re)}j.done?he(q):Promise.resolve(q).then(Ye,st)}function Y(Ke){return function(){var he=this,ve=arguments;return new Promise(function(Ye,st){var ut=Ke.apply(he,ve);function Qe(q){H(ut,Ye,st,Qe,j,"next",q)}function j(q){H(ut,Ye,st,Qe,j,"throw",q)}Qe(void 0)})}}be.d(wt,{Z:()=>Y})}}]);